<!DOCTYPE html>

<html>
<head>
    <script type="text/javascript"> var checkpoint = true; </script>

    <meta name="viewport" content="height=device-height,width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=no;" />

    <title>ohmage | login</title>

    <style type="text/css">
        @import url("http://m.ucla.edu/old/assets/css.php");
    </style>

    <!-- IMPORT MWF JAVASCRIPT LIBRARY -->
    <script type="text/javascript" src="http://m.ucla.edu/old/assets/js.php"></script>
    <script type="text/javascript" src="js/mwf/decorator.js"> </script>
    <script type="text/javascript" src="js/mwf/content.js"> </script>
    <script type="text/javascript" src="js/mwf/button.js"> </script>
    <script type="text/javascript" src="js/mwf/menu.js"> </script>


    <!-- IMPORT PHONEGAP LIBRARY -->
    <script type="text/javascript" src="js/phonegap/phonegap-1.0.0.js"> </script>

    <!-- IMPORT JQUERY AND EXTENSIONS -->
    <script type="text/javascript" src="js/jquery/jquery.js"></script>
    <script type="text/javascript" src="js/jquery/jquery.extensions.js"></script>

    <!-- IMPORT OHMAGE API JS LIB -->
    <script type="text/javascript" src="js/api.js"></script>
    <script type="text/javascript" src="js/PageNavigation.js"></script>
    <script type="text/javascript" src="js/UserAuthentication.js"></script>


    <script type="text/javascript">

        $(document).ready(function(){

            var isInputValid = function(){

                if($('#current-password').val().length == 0){
                    alert('Please enter your current password.');
                    $('#current-password').focus();
                    return false;
                }

                if($('#new-password').val().length == 0){
                    alert('Please enter your new password.');
                    $('#new-password').focus();
                    return false;
                }


                if($('#confirm-password').val().length == 0){
                    alert('Please confirm your password.');
                    $('#confirm-password').focus();
                    return false;
                }

                if($('#new-password').val() != $('#confirm-password').val()){
                    alert('New password and password confirmation do not match.');
                    $('#confirm-password').focus();
                    return false;
                }

                if(!auth.isPasswordValid($('#new-password').val())){
                    alert(auth.getPasswordRequirements());
                    $('#new-password').focus();
                    return false;
                }

                return true;

            };

            $("#change-password").click(function(){

                if(!isInputValid())
                    return;

                var currentPassword = $("#current-password").val();
                var newPassword     = $("#new-password").val();

                var onSuccess = function() {
                    auth.setAuthErrorState(true);
                    alert('Your password has been successfully changed. Please login to continue.');
                    PageNavigation.openAuthenticationPage();
                };

                var onError = function(response){

                    if(response){
                        alert(response.errors[0].text);
                    }else{
                        alert('Network error occured. Please try again.');
                    }

                    $('#current-password').focus();

                };

                api(
                     "POST",
                     PASSWORD_CHANGE_URL,
                     {
                         auth_token:   auth.getHashedPassword(),
                         client:       'MWoC',
                         user:         auth.getUsername(),
                         password:     currentPassword,
                         new_password: newPassword

                     },
                     "JSON",
                     onSuccess,
                     onError,
                     false
                );



           });

        });


    </script>


</head>
<body>

    <a class="button-full button-padded" id="button-top" href="index.html">Dashboard</a>

    <h1 id="header">
        <a href="index.html">
            <img src="img/ohmage-icon-gray-noshadow-30px.png" alt="ohmage" width="30" height="30" style="padding-left:3px; padding-top:3px;"/>
            <span>ohmage</span>
         </a>

    </h1>

    <form class="form-full form-padded">

        <h1 class="light form-first">Password Change Form</h1>

        <label for="current-password">Current Password</label>
        <input type="password" name="current-password" id="current-password"/>

        <label for="new-password">New Password</label>
        <input type="password" name="new-password" id="new-password"/>

        <label for="confirm-password">Confirm Password</label>
        <input type="password" name="confirm-password" id="confirm-password"/>

        <input type="button" id="change-password" name="submit" value="Change Password" class="form-last" />

    </form>

    <div class="button-padded button-full button-light"><a class="button-light" href="profile.html">Profile</a></div>

    <div id="footer">
        <p>Copyright &copy; 2012 MobilizeLabs<br />
        <a href="privacy.html">View Our Privacy Policy</a></p>
    </div>

</body>
</html>