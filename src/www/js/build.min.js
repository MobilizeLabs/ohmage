var PageNavigation,PageNavigationInitializer=function(){var a={},b=new LocalMap("page-parameters"),d={};a.setPageParameter=function(a,b,f){"undefined"!==typeof b?d[a]=b.toString():"undefined"!==typeof f&&(d[a]=f.toString())};a.unsetPageParameter=function(a){b.release(a)};a.redirect=function(a){"undefined"!==typeof a&&(b.importMap(d),document.location=a)};a.isPageParameterSet=function(c){return null!==a.getPageParameter(c)};a.getPageParameters=function(){return b.getMap()};a.getPageParameter=function(a){return b.get(a)};
a.openRemindersView=function(){a.redirect("reminders.html")};a.openReminderView=function(c){a.setPageParameter("uuid",c);a.redirect("reminder.html")};a.openNewReminderView=function(){a.unsetPageParameter("uuid");a.redirect("reminder.html")};a.openInstalledCampaignsView=function(){a.redirect("installed-campaigns.html")};a.openAvailableCampaignsView=function(){a.redirect("available-campaigns.html")};a.openCampaignView=function(c){a.setPageParameter("campaign-urn",c);a.redirect("campaign.html")};a.openServerChangeView=
function(){a.redirect("change-server.html")};a.openSurveyView=function(c,b){a.setPageParameter("campaign-urn",c);a.setPageParameter("survey-id",b);a.redirect("survey.html")};a.openPendingSurveysView=function(){a.redirect("pending-surveys.html")};a.openUploadQueueView=function(){a.redirect("upload-queue.html")};a.openSurveyResponseView=function(c){a.setPageParameter("survey-key",c);a.redirect("survey-response-view.html")};a.openAuthenticationPage=function(){a.redirect("auth.html")};a.openDashboard=
function(){a.redirect("index.html")};a.openChangePasswordPage=function(){a.redirect("change-password.html")};a.openPrivacyPage=function(){a.redirect("privacy.html")};a.openProfilePage=function(){a.redirect("profile.html")};a.openHelpMenuView=function(){a.redirect("help-menu.html")};a.openHelpSectionView=function(c){a.setPageParameter("help-section-index",c);a.redirect("help-section.html")};a.goBack=function(){"undefined"!==typeof navigator.app?navigator.app.backHistory():window.history.back()};a.goForward=
function(){"undefined"!==typeof navigator.app?navigator.app.forwardHistory():window.history.forward()};PageNavigation=a},UserAuthentication=function(){var a={},b=new LocalMap("credentials"),d=function(a,c){"undefined"!==typeof c&&b.set(a,c);return b.get(a)},c=function(c,b){return!a.isInAuthErrorState()&&null!==d(c)?(PageNavigation.redirect(b),!0):!1};a.getPasswordRequirements=function(){return"The password must be between 8 and 16 characters, contain at least one lower case character, contain at least one upper case character, contain at least one digit, and contain at least one of the following characters ',', '.', '<', '>', '[', ']', '!', '@', '#', '$', '%', '^', '&', '*', '+', '-', '/', '=', '?', '_', '{', '}', '|', ':'."};
a.isPasswordValid=function(a){return/^((?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[,\.<>:\[\]!@#$%^&*+-/=?_{|}]).{8,16})$/.test(a)};a.isUserLocked=function(){return null!==a.getUsername()};a.setAuthErrorState=function(a){d("auth-error",a)};a.isInAuthErrorState=function(){return d("auth-error")};a.getAuthToken=function(){return d("auth_token")};a.getHashedPassword=function(){return d("hashed_password")};a.logout=function(){MessageDialogController.showConfirm("All data will be lost. Are you sure you would like to proceed?",
function(a){a&&(console.log("UserAuthentication: User confirmed logout. Deleting data..."),d("auth_token",null),d("hashed_password",null),d("username",null),d("auth-error",null),ReminderModel.cancelAll(),window.localStorage.clear(),window.localStorage["page-parameters"]="{}",PageNavigation.openAuthenticationPage())},"Yes,No")};a.checkpoint=function(){if(!a.isUserAuthenticated()||a.isInAuthErrorState())console.log("User failed checkpoint - redirecting to the authentication page."),PageNavigation.redirect("auth.html")};
a.isUserAuthenticated=function(c){return a.isUserAuthenticatedByHash()||a.isUserAuthenticatedByToken()?(PageNavigation.redirect(c),!0):!1};a.isUserAuthenticatedByHash=function(a){return c("hashed_password",a)};a.isUserAuthenticatedByToken=function(a){return c("auth_token",a)};a.getUsername=function(){return d("username")};a.authenticateByHash=function(c,b,h){a.isUserAuthenticatedByHash()&&h(!0);ServiceController.serviceCall("POST","/app/user/auth",{user:c,password:b,client:"1"},"JSON",function(b){d("hashed_password",
b.hashed_password);d("username",c);a.setAuthErrorState(!1);h(!0)},function(a){h(!1,a?a.errors[0].text:null)})};a.authenticateByToken=function(c,b,h){a.isUserAuthorizedByToken()&&h(!0);ServiceController.serviceCall("POST","/app/user/auth_token",{user:c,password:b,client:"1"},"JSON",function(b){d("auth_token",b.token);d("username",c);a.setAuthErrorState(!1);h(!0)},function(a){h(!1,a?a.errors[0].text:null)})};return a},ConfigManager,ConfigManagerInitializer=function(){var a={},b=LocalMap("config"),d=
["https://test.ohmage.org","https://pilots.mobilizelabs.org"],c={SERVER_ENDPOINT:d[0],CAMPAIGN_READ_URL:"/app/campaign/read",SURVEY_UPLOAD_URL:"/app/survey/upload",PASSWORD_CHANGE_URL:"/app/user/change_password",GPS_ENABLED:!0,CONFIRM_TO_UPLOAD_ON_SUBMIT:!0,CLIENT_NAME:"ohmage-mwf"};a.reset=function(){b.importMap(c)};a.getProperty=function(a){return b.get(a)};a.getServers=function(){return d};var g,f,h,i=function(a){return a[1].toUpperCase()},j=function(c){return function(){return a.getProperty(c)}},
k=function(a){return function(c){b.set(a,c)}};for(g in c)f=("get_"+g.toLowerCase()).replace(/_([a-z])/g,i),h=("set_"+g.toLowerCase()).replace(/_([a-z])/g,i),a[f]=j(g),a[h]=k(g);for(var n in c)b.isSet(n)||b.set(n,c[n]);ConfigManager=a},CampaignController=function(a){var b={},d=function(c){c&&(CampaignsModel.uninstallCampaign(a.getURN()),PageNavigation.goBack())};b.deleteCampaignHandler=function(){MessageDialogController.showConfirm("All data will be lost. Are you sure you would like to proceed?",d,
"Yes,No")};b.renderCampaignView=function(){var c=CampaignView(a);c.openSurveyViewHandler=CampaignController.openSurveyViewHandler;c.deleteCampaignHandler=b.deleteCampaignHandler;return c.render()};return b};CampaignController.openSurveyViewHandler=function(a,b){PageNavigation.openSurveyView(a,b)};
var CampaignsController=function(){var a={},b=function(){PageNavigation.openInstalledCampaignsView()},d=function(){MessageDialogController.showMessage("Unable to install campaign. Please try again later.")},c=function(){MessageDialogController.showMessage("All campaigns have been updated.",PageNavigation.openAvailableCampaignsView)},g=function(){MessageDialogController.showMessage("Unable to download all campaigns. Please try again.")};a.installNewCampaignHandler=function(a){CampaignModel.install(a,
b,d)};a.openMyCampaignHandler=function(a){PageNavigation.openCampaignView(a)};a.refreshCampaignsListHandler=function(){CampaignsModel.download(!0,c,g)};a.renderInstalledCampaigns=function(){var c=CampaignsView(CampaignsModel);c.openMyCampaignHandler=a.openMyCampaignHandler;return c.renderMyCampaigns()};a.renderAvailableCampaigns=function(){var c=CampaignsView(CampaignsModel);c.installNewCampaignHandler=a.installNewCampaignHandler;c.refreshCampaignsListHandler=a.refreshCampaignsListHandler;return c.renderAvailableCampaigns()};
return a}(),ChangeServerController=function(){return{renderChangeServerView:function(){var a=ChangeServerView(ConfigManager.getServers());a.saveButtonHandler=function(){ConfigManager.setServerEndpoint(a.getSelectedServer());console.log("ChangeServerController: Saved a new server endpoint ["+ConfigManager.getServerEndpoint()+"].");MessageDialogController.showMessage("Your selection has been saved.",PageNavigation.openAuthenticationPage)};return a.render()}}},HelpController=function(){var a={},b=new HelpModel;
a.renderHelpMenu=function(){return(new HelpMenuView(b.getAllSections())).render()};a.renderHelpSection=function(a){return(new HelpSectionView(b.getHelpSection(a))).render()};return a},MessageDialogController=function(){return{showMessage:function(a,b,d,c){d=d||"ohmage";c=c||"OK";navigator.notification&&navigator.notification.alert?navigator.notification.alert(a,b,d,c):(alert(a),b&&"function"===typeof b&&b(void 0))},showConfirm:function(a,b,d,c){var d=d||"OK,Cancel",g=d.split(","),c=c||"ohmage";navigator.notification&&
navigator.notification.confirm?navigator.notification.confirm(a,function(a){b&&(DeviceDetection.isDeviceiOS()&&(a=g.length-a),b(1===a))},c,d):(a=confirm(a),b&&"function"===typeof b&&b(a))}}}(),ProfileController=function(){var a={changePasswordHandler:function(){PageNavigation.openChangePasswordPage()},enableGpsHandler:function(){ConfigManager.setGpsEnabled(!0);PageNavigation.openProfilePage()},disableGpsHandler:function(){ConfigManager.setGpsEnabled(!1);PageNavigation.openProfilePage()},clearCustomizedChoicesHandler:function(){MessageDialogController.showConfirm("Are you sure you would like to clear all your custom choices?",
function(a){a&&(CustomPropertiesVault.deleteAllCustomProperties(),MessageDialogController.showMessage("All custom choices have been cleared."))},"Yes,No")},logoutAndClearDataHandler:function(){auth.logout()&&PageNavigation.openAuthenticationPage()},renderProfileView:function(){var b=ProfileView();b.changePasswordHandler=a.changePasswordHandler;b.clearCustomizedChoicesHandler=a.clearCustomizedChoicesHandler;b.logoutAndClearDataHandler=a.logoutAndClearDataHandler;b.disableGpsHandler=a.disableGpsHandler;
b.enableGpsHandler=a.enableGpsHandler;return b.render()}};return a},PromptController=function(a,b){var d={},c=a.getSurveyModel(),g=c.getPrompts(),f=SurveyResponseModel.init(c.getID(),c.getCampaign().getURN()),h=0,i=null,j=null,k=function(){null!==j&&j()},n=function(){DeviceDetection.isDeviceAndroid()&&document.removeEventListener("backbutton",k,!1)},q=function(){return g[h]||null},p=function(){var a=q().getCondition(),c=f.getResponses();return a&&!ConditionalParser.parse(a,c)},t={},r=function(){n();
f.submit();i(f)},v=function(a){var c=q();if(a){if(!c.isSkippable())return!1;f.promptSkipped(c.getID());return!0}if(!c.isValid())return MessageDialogController.showMessage(c.getErrorMessage()),!1;f.respond(c.getID(),c.getResponse(),"photo"===c.getType());return!0},x=function(a){if(v(a)){for(h+=1;h<g.length&&p();)f.promptNotDisplayed(q().getID()),h+=1;z()}},m=function(){for(0<h&&(h-=1);0<h&&p();)h-=1;z()},s=function(a){var c=document.createElement("div");!a&&q().isSkippable()&&c.appendChild(mwf.decorator.SingleClickButton(q().getSkipLabel(),
function(){x(!0)}));j=m;0===h?(c.appendChild(mwf.decorator.SingleClickButton("Next Prompt",function(){x(!1)})),j=function(){d.confirmSurveyExit(function(){PageNavigation.goBack()})}):a?c.appendChild(mwf.decorator.DoubleClickButton("Previous",m,"Submit",r)):c.appendChild(mwf.decorator.DoubleClickButton("Previous",m,"Next",function(){x(!1)}));return c},z=function(){b.innerHTML="";var a;h<g.length?(t[q().getID()]?b.appendChild(t[q().getID()]):b.appendChild(t[q().getID()]=q().render()),a=s(!1)):(a=mwf.decorator.Menu("Survey Completed"),
a.addMenuTextItem("Done with "+c.getTitle()),b.appendChild(a),a=s(!0));b.appendChild(a)};d.start=function(a){ConfigManager.getGpsEnabled()&&f.setLocation();z();i=a;DeviceDetection.isDeviceAndroid()&&Init.invokeOnReady(function(){console.log("Overriding back button on Android devices for current survey navigation.");document.addEventListener("backbutton",k,!0)})};d.abort=function(){n();null!==f&&!f.isSubmitted()&&SurveyResponseModel.deleteSurveyResponse(f)};d.confirmSurveyExit=function(a){MessageDialogController.showConfirm("Data from your current survey response will be lost. Are you sure you would like to continue?",
function(c){c&&(d.abort(),"function"===typeof a&&a())},"Yes,No")};return d},ReminderController=function(a){var b={},d=a?new ReminderModel(a):new ReminderModel;b.render=function(){return(new ReminderView(d,b)).render()};b.save=function(a,b,f,h,i,j,k){d.setAssociation(a,b);d.setSupressionWindow(i);d.setExcludeWeekends(k);d.setTitle(f);d.setMessage("Reminder: "+f);d.cancelAllNotifications();h.getTime()<(new Date).getTime()&&(h=new Date(h.getTime()+864E5));for(a=0;a<j;a+=1){if(d.excludeWeekends())for(;6===
h.getDay()||0===h.getDay();)h=new Date(h.getTime()+864E5);d.addNotification(h);h=new Date(h.getTime()+864E5)}d.save()};b.getReminderCount=function(){return ReminderModel.getAllReminders().length};return b},RemindersController=function(){return{render:function(){var a=ReminderModel.getCurrentReminders();return(new RemindersView(a)).render()}}},ServiceController=function(){var a={},b=function(a,c){a&&"function"===typeof a&&a(c)},d=function(a,c,h,i){return function(j){console.log("Received response for URL ("+
h+") with the following response data: "+window.JSON.stringify(j));switch(j.result){case "success":b(a,j);break;case "failure":b(c,j);if(i){var k;for(k=0;k<j.errors.length;k+=1)if("0200"===j.errors[k].code){auth.setAuthErrorState(!0);PageNavigation.openAuthenticationPage();break}}break;default:b(d,j)}}},c=function(a,c){return function(){console.log("AJAX exception for url "+(ConfigManager.getServerEndpoint()+c));b(a,!1)}};a.serviceCall=function(a,b,h,i,j,k,n){n="undefined"===typeof n?!0:n;console.log("Initiating an API call for URL ("+
ConfigManager.getServerEndpoint()+b+") with the following input data: "+window.JSON.stringify(h));$.ajax({type:a,url:ConfigManager.getServerEndpoint()+b,data:h,dataType:i,success:d(j,k,b,n),error:c(k,b)})};return a}(),PendingSurveysController=function(){return{render:function(){var a=ReminderModel.getPendingSurveys(),a=new SurveyListView(a,"Pending Surveys",function(a){alert(a.getID())});a.setEmptyListViewParameters("You have no pending surveys.","Please navigate to the reminders to set new notifications.",
PageNavigation.openRemindersView);return a.render()}}},SurveyController=function(a){var b={},d=function(c){ReminderModel.supressSurveyReminders(a.getID());var b=function(){PageNavigation.goBack()},d=function(d){d?(new SurveyResponseUploadController(a,c)).upload(function(){MessageDialogController.showMessage("Successfully uploaded your survey response.",function(){SurveyResponseModel.deleteSurveyResponse(c);b()})},function(){MessageDialogController.showMessage("Unable to upload your survey response at this time.",
b)},ConfigManager.getGpsEnabled()):b()};ConfigManager.getConfirmToUploadOnSubmit()?MessageDialogController.showConfirm("Would you like to upload your response?",d,"Yes,No","ohmage"):d(!0)};b.promptController=null;b.start=function(a){b.promptController=new PromptController(b,a);b.promptController.start(d);return b.promptController};b.getSurveyModel=function(){return a};return b},SurveyResponseController=function(a){var b={},d=CampaignModel(a.getCampaignURN()),c=d.getSurvey(a.getSurveyID());b.render=
function(){return(new SurveyResponseView(b)).render()};b.uploadSurveyResponseCallback=function(){(new SurveyResponseUploadController(c,a)).upload(function(){MessageDialogController.showMessage("Successfully uploaded your survey response.",function(){SurveyResponseModel.deleteSurveyResponse(a);PageNavigation.openUploadQueueView()})},function(){MessageDialogController.showMessage("Unable to upload survey response at this time. Please try again later.")},ConfigManager.getGpsEnabled())};b.deleteSurveyResponseCallback=
function(){MessageDialogController.showConfirm("Are you sure you would like to delete your response?",function(c){c&&(SurveyResponseModel.deleteSurveyResponse(a),PageNavigation.openUploadQueueView())},"Yes,No")};b.getSurvey=function(){return c};b.getSurveyResponseModel=function(){return a};b.getCampaign=function(){return d};return b},SurveyResponseUploadController=function(a,b){var d={},c=function(){var c=b.getUploadData();return{campaign_urn:b.getCampaignURN(),campaign_creation_timestamp:a.getCampaign().getCreationTimestamp(),
user:auth.getUsername(),password:auth.getHashedPassword(),client:ConfigManager.getClientName(),surveys:window.JSON.stringify([c.responses]),images:window.JSON.stringify(c.images)}},g=function(a){Spinner.show();b.setLocation(function(c){Spinner.hide();c?a(!0):MessageDialogController.showConfirm("Geolocation failed. Would you like to try again?",function(c){c?g(a):a(!1)},"Yes,No")})};d.upload=function(d,h,i){"undefined"===typeof i&&(i=12E4>(new Date).getTime()-b.getSubmitDate().getTime());var j=function(a){Spinner.show();
ServiceController.serviceCall("POST",ConfigManager.getSurveyUploadUrl(),a,"JSON",function(a){console.log("SurveyResponseUploadController: Successfully returned from single survey response upload script.");Spinner.hide(function(){d&&d(a)})},function(a){Spinner.hide(function(){h&&h(a)})})};!b.isLocationAvailable()&&i?(i="Survey '"+a.getTitle()+"' does not have a valid GPS location. Would you like to try set it?",MessageDialogController.showConfirm(i,function(a){a?g(function(){j(c())}):j(c())},"Yes,No")):
j(c())};return d};SurveyResponseUploadController.uploadAll=function(a,b,d){var c=0,g=[],f;for(f in a)g.push(f);var h=function(f){if(f>=g.length)Spinner.hide(function(){"function"===typeof b&&b(c)});else{var j=a[g[f]].response;(new SurveyResponseUploadController(a[g[f]].survey,j)).upload(function(){c+=1;SurveyResponseModel.deleteSurveyResponse(j);h(f);f+=1},function(){h(f);f+=1},d)}};Spinner.show();h(0)};var SurveysController=function(){return{}}();
SurveysController.renderSurveyList=function(){var a=CampaignsModel.getInstalledCampaigns(),b=mwf.decorator.Menu("Available Surveys"),d;for(d in a)a[d].isRunning()&&CampaignView.renderSurveyList(a[d],b,CampaignController.openSurveyViewHandler);0===b.size()&&(a=b.addMenuLinkItem("No Available Surveys",null,"Please install a campaign, to view available surveys."),TouchEnabledItemModel.bindTouchEvent(a,a,PageNavigation.openAvailableCampaignsView,"menu-highlight"));return b};
var UploadQueueController=function(){var a={},b=SurveyResponseModel.getPendingResponses();a.deleteAllCallback=function(){MessageDialogController.showConfirm("Are you sure you would like to delete all your responses?",function(a){var c;if(a){for(c in b)SurveyResponseModel.deleteSurveyResponse(b[c].response);PageNavigation.openUploadQueueView()}},"Yes,No")};a.uploadAllCallback=function(){SurveyResponseUploadController.uploadAll(b,function(a){MessageDialogController.showMessage(0===a?"Unable to upload any surveys at this time.":
"Successfully uploaded "+a+" survey(s).",function(){PageNavigation.openUploadQueueView()})},ConfigManager.getGpsEnabled())};a.getPendingResponses=function(){return b};a.render=function(){return(new UploadQueueView(a)).render()};return a},auth,checkpoint=!1,Init=function(){var a={},b=!1;a.invokeOnReady=function(a){$(document).ready(function(){b||(ConfigManagerInitializer(),PageNavigationInitializer(),auth=new UserAuthentication,"undefined"!==typeof checkpoint&&checkpoint&&auth.checkpoint(),b=!0);DeviceDetection.isOnDevice()&&
DeviceDetection.isNativeApplication()?document.addEventListener("deviceready",a,!1):a&&"function"===typeof a&&a()})};return a}(),CustomPropertiesVault=function(a){var b={},d=new LocalMap(CustomPropertiesVault.VAULT_LOCAL_MAP_NAME),c=a.getCampaignURN(),g=a.getSurveyID(),f=a.getID(),h,i,j,k=function(){h=d.get(c)||{};i=h[g]||{};j=i[f]||[]},n=function(){i[f]=j;h[g]=i;d.set(c,h)};b.addCustomProperty=function(a){k();j.push(a);n()};b.getCustomProperties=function(){k();return j};b.deleteCustomProperties=
function(){k();j=[];n()};return b};CustomPropertiesVault.VAULT_LOCAL_MAP_NAME="custom-properties-vault";CustomPropertiesVault.deleteAllCustomProperties=function(){(new LocalMap(CustomPropertiesVault.VAULT_LOCAL_MAP_NAME)).erase()};
var CampaignModel=function(a){var b={},d=(new LocalMap("all-campaigns")).get(a),c=(new LocalMap("campaign-configurations")).get(a);b.getSurveys=function(){var a=c.surveys.survey;return!a.length?[a]:a};b.isRunning=function(){return"running"===d.running_state};b.getSurvey=function(a){var c=b.getSurveys(),d;for(d=0;d<c.length;d+=1)if(c[d].id===a)return SurveyModel(c[d],b);return null};b.getName=function(){return d.name};b.getURN=function(){return a};b.getCreationTimestamp=function(){return d.creation_timestamp};
b.getDescription=function(){return d.description};return b};
CampaignModel.install=function(a,b,d){Spinner.show();ServiceController.serviceCall("POST",ConfigManager.getCampaignReadUrl(),{user:auth.getUsername(),password:auth.getHashedPassword(),client:ConfigManager.getClientName(),campaign_urn_list:a,output_format:"long"},"JSON",function(c){Spinner.hide(function(){"success"===c.result&&((new LocalMap("installed-campaigns")).set(a,Math.round((new Date).getTime()/1E3)),(new LocalMap("campaign-configurations")).set(a,CampaignModel.parse(c.data[a].xml)),b&&b())})},
function(a){Spinner.hide(function(){d&&d(a)})})};CampaignModel.parse=function(a){a=a.replace(/<default>/g,"<defaultValue>").replace(/<\/default>/g,"</defaultValue>").replace(/<default\/>/g,"<defaultValue/>");return $.xml2json.parser(a).campaign};
var CampaignsModel,CampaignsModelInitializer=function(){var a={},b=LocalMap("all-campaigns"),d=LocalMap("installed-campaigns");a.isEmpty=function(){return 0===b.length()};a.getInstalledCampaignsCount=function(){return d.length()};a.getCampaign=function(a){return CampaignModel(a)};a.uninstallCampaign=function(a){d.release(a);ReminderModel.deleteCampaignReminders(a)};a.getAllCampaigns=function(){var a={},d;for(d in b.getMap())a[d]=CampaignsModel.getCampaign(d);return a};a.getAvailableCampaigns=function(){var a=
{},g;for(g in b.getMap())d.isSet(g)||(a[g]=CampaignsModel.getCampaign(g));return a};a.getInstalledCampaigns=function(){var a={},b;for(b in d.getMap())a[b]=CampaignsModel.getCampaign(b);return a};a.download=function(c,b,d){void 0===typeof c&&(c=!1);!c&&!a.isEmpty()?b&&b():(Spinner.show(),ServiceController.serviceCall("POST",ConfigManager.getCampaignReadUrl(),{user:auth.getUsername(),password:auth.getHashedPassword(),client:ConfigManager.getClientName(),output_format:"short"},"JSON",function(a){Spinner.hide(function(){if("success"===
a.result){var c=LocalMap("all-campaigns"),d;c.erase();for(d in a.data)c.set(d,a.data[d]);b&&b()}})},function(a){Spinner.hide(function(){d&&d(a)})}))};CampaignsModel=a},HelpModel=function(){var a={},b=[{title:"Using the Dashboard",text:"Dashboard is the main page of the application. It allows quick access to campaigns, surveys, the upload queue, help tutorials and also allows users to log out.",img:"img/screenshots/dashboard.png"},{title:"Installing Campaigns",text:"To install a new campaign, navigate to the campaigns section from the dashboard, and click on one of the campaigns listed under the 'Available Campaigns' menu. If there are currently no campaigns installed on the phone, you will automatically be redirected to the available campaigns section. ",
img:"img/screenshots/installing-campaigns.png"},{title:"Taking Surveys",text:"Click on one of the surveys to answer survey related prompts.",img:"img/screenshots/taking-surveys.png"},{title:"Uploading Responses",text:"You can view responses that have not been uploaded in the upload queue section. Here you have the option to delete all the pending uploads, upload all responses, or upload/delete individual survey responses.",img:"img/screenshots/uploading-responses.png"},{title:"Changing Password",
text:"Enter your current password, a new password and a confirmation of the new password to change your password. When your password is successfully changed, you will be directed to the login page where you can use your new password to login.",img:"img/screenshots/changing-password.png"}];a.getAllSections=function(){return b};a.getHelpSection=function(a){return b[a]};return a},PromptModel=function(a,b,d){var c={},g=null,f={},h=null,i=null;c.summarizeResponse=function(a){var b="";if(a===SurveyResponseModel.NOT_DISPLAYED_PROMPT_VALUE||
a===SurveyResponseModel.SKIPPED_PROMPT_VALUE)return a;switch(c.getType()){case "photo":b=a!==SurveyResponseModel.SKIPPED_PROMPT_VALUE?"<center><img src='"+Base64.formatImageSrcString(SurveyResponseModel.getImage(a))+"' width='100%' /></center>":a;break;case "single_choice":b=c.getProperty(a[0]).label;break;case "multi_choice":var a=a.toString().split(","),b=[],d;for(d in a)b.push(c.getProperty(d).label);b=b.join(", ");break;default:b=a}return b};c.render=function(){return f.render()};c.isValid=function(){return!0};
c.getErrorMessage=function(){null===g&&c.isValid();return g||!1};c.setErrorMessage=function(a){g=a};c.getResponse=function(){return c.getDefaultValue()};c.getProperties=function(){return i};c.getProperty=function(a){var b=c.getProperties(),d;for(d=0;d<b.length;d+=1)if(b[d].key===a)return b[d];return null};c.getMinValue=function(){var a=c.getProperty("min");return null!==a?a.label:null};c.getMaxValue=function(){var a=c.getProperty("max");return null!==a?a.label:null};c.addProperty=function(a,c){var b=
{key:c||i.length,label:a},d;a:{for(d=0;d<i.length;d+=1)if(i[d].label===b.label){d=!0;break a}d=!1}if(d)return!1;i.push(b);h.addCustomProperty(b);return b};c.getCampaignURN=function(){return d.getURN()};c.getSurveyID=function(){return b.getID()};c.getID=function(){return a.id};c.getCondition=function(){if("undefined"!==typeof a.condition){var c=a.condition,c=c.replace(/&gt;/g,">");return c=c.replace(/&lt;/g,"<")}return null};c.getType=function(){return a.prompttype};c.getText=function(){return a.prompttext||
""};c.isSkippable=function(){return"true"===a.skippable};c.getSkipLabel=function(){return a.skiplabel};c.getDefaultValue=function(){return"undefined"!==typeof a.defaultvalue?a.defaultvalue:null};var h=new CustomPropertiesVault(c),j,k,i=!a.properties||!a.properties.property?[]:a.properties.property.length?a.properties.property:[a.properties.property];j=h.getCustomProperties();for(k=0;k<j.length;k+=1)i.push(j[k]);return c},ReminderModel=function(a){var b={},d="",c="",g="",f="",h="",i=LocalNotificationAdapter,
j=24,k=!1,n=[],q=function(a){a.date.getTime()>=(new Date).getTime()&&(console.log("ReminderModel: Canceling notification with id ["+a.id+"] associated with survey ["+g+"]"),i.cancel(a.id))};b.toJSON=function(){var a={title:d,campaign_urn:c,survey_id:g,message:f,ticker:h,supression_window:j,exclude_weekends:k},b;a.notifications=[];for(b=0;b<n.length;b+=1)a.notifications.push({id:n[b].id,time:n[b].date.getTime()});return a};b.addNotification=function(a){var c=ReminderModel.getNextAvailableNotificationID(),
b={date:a,message:f,ticker:h,repeatDaily:!1,id:c};console.log("ReminderModel: Notification was set with the following options - "+window.JSON.stringify(b));i.add(b);n.push({id:c,date:a});return b};b.save=function(){ReminderModel.reminders.set(a,b.toJSON())};b.isSaved=function(){return ReminderModel.reminders.isSet(a)};b.cancelAllNotifications=function(){var a;for(a=0;a<n.length;a+=1)q(n[a]);n=[];b.save()};b.deleteReminder=function(){console.log("ReminderModel: Deleting reminder with the following UUID ["+
a+"].");b.cancelAllNotifications();ReminderModel.reminders.release(a)};b.suppress=function(a){var a=a||new Date,c=[],d,f=36E5*j,g=!1;for(d=0;d<n.length;d+=1)n[d].date.getTime()-a.getTime()<f?(q(n[d]),g=!0):c.push(n[d]);n=c;0===n.length?b.deleteReminder():b.save();return g};b.restore=function(b){var i=ReminderModel.reminders.get(b);a=b;d=i.title;c=i.campaign_urn;g=i.survey_id;f=i.message;h=i.ticker;j=i.supression_window;k=i.exclude_weekends;n=[];for(b=0;b<i.notifications.length;b+=1)n.push({id:i.notifications[b].id,
date:new Date(i.notifications[b].time)})};b.setAssociation=function(a,b){c=a;g=b};b.setMessage=function(a){h=f=a};b.setTitle=function(a){d=a};b.setSupressionWindow=function(a){j=a};b.setExcludeWeekends=function(a){k=a};b.isExpired=function(){return 0===n.length||n[n.length-1].date.getTime()<=(new Date).getTime()};b.getUUID=function(){return a};b.getCampaignURN=function(){return c};b.getSurveyID=function(){return g};b.getTitle=function(){return d};b.getDate=function(){return 0!==n.length?n[0].date:
null};b.getSupressionWindow=function(){return parseInt(j,10)};b.excludeWeekends=function(){return k};b.getRecurrence=function(){return n.length};b.getNotifications=function(){return n};b.getMessage=function(){return f};b.setNotificationAdapter=function(a){i=a};"undefined"!==typeof a?b.restore(a):a=UUIDGen.generate();return b};
ReminderModel.getNextAvailableNotificationID=function(){ReminderModel.remindersMetadata.isSet("last-id")||ReminderModel.remindersMetadata.set("last-id",0);var a=ReminderModel.remindersMetadata.get("last-id");ReminderModel.remindersMetadata.set("last-id",a+1);return a};ReminderModel.remindersMetadata=new LocalMap("reminders-metadata");ReminderModel.reminders=new LocalMap("reminders");
ReminderModel.getAllReminders=function(){var a=ReminderModel.reminders.getMap(),b=[],d;for(d in a)a.hasOwnProperty(d)&&b.push(new ReminderModel(d));return b};ReminderModel.cancelAll=function(){console.log("ReminderModel: Cancelling all reminders.");var a=ReminderModel.getAllReminders(),b;for(b=0;b<a.length;b+=1)a[b].deleteReminder()};
ReminderModel.supressSurveyReminders=function(a){console.log("ReminderModel: Supressing all reminders for survey ["+a+"].");var b=ReminderModel.getAllReminders(),d;for(d=0;d<b.length&&!(b[d].getSurveyID()===a&&b[d].suppress());d+=1);};ReminderModel.deleteCampaignReminders=function(a){console.log("ReminderModel: Deleting all reminders associated with campaign ["+a+"].");var b=ReminderModel.getAllReminders(),d;for(d=0;d<b.length;d+=1)b[d].getCampaignURN()===a&&b[d].deleteReminder()};
ReminderModel.getPendingSurveys=function(){var a=(new Date).getTime(),b=ReminderModel.getAllReminders(),d,c=[],g;for(g=0;g<b.length;g+=1)b[g].getDate().getTime()<a&&(d=CampaignModel(b[g].getCampaignURN()),c.push(d.getSurvey(b[g].getSurveyID())));return c};ReminderModel.getCurrentReminders=function(){var a=ReminderModel.getAllReminders(),b=[],d;for(d=0;d<a.length;d+=1)a[d].isExpired()||b.push(a[d]);return b};
var SurveyModel=function(a,b){var d={getTitle:function(){return a.title||""},getDescription:function(){return a.description||""},getID:function(){return a.id},getCampaign:function(){return b},getPrompts:function(){var c=a.contentlist.prompt,g=[],f;if(c.length)for(f=0;f<c.length;f+=1)g[f]=PromptModel(c[f],d,b);else g.push(PromptModel(c,d,b));return g},getPrompt:function(a){var b=d.getPrompts(),f;for(f=0;f<b.length;f+=1)if(b[f].getID()===a)return b[f];return null}};return d},SurveyResponseModel=function(a,
b,d){var c={data:{}};c.data.campaign_urn=d;c.data.location_status=SurveyResponseModel.LocationStatus.UNAVAILABLE;c.data.survey_key=b;c.data.survey_id=a;c.data.timezone=jstz.determine_timezone().name();c.data.time=null;c.data._responses={};c.data.survey_launch_context={launch_time:(new Date).getTime(),launch_timezone:jstz.determine_timezone().name(),active_triggers:[]};c.data.location=null;c.isLocationAvailable=function(){return null!==c.data.location};c.manuallySetLocation=function(a){c.data.location_status=
SurveyResponseModel.LocationStatus.VALID;c.data.location=a};c.setLocation=function(a){c.data.location_status=SurveyResponseModel.LocationStatus.UNAVAILABLE;c.data.location=null;mwf.touch.geolocation.getPosition(function(b){c.data.location={};c.data.location.provider="GPS";c.data.location.latitude=b.latitude;c.data.location.longitude=b.longitude;c.data.location.accuracy=b.accuracy;c.data.location_status=SurveyResponseModel.LocationStatus.VALID;c.data.location.time=(new Date).getTime();c.data.location.timezone=
jstz.determine_timezone().name();c.save();a&&a(!0)},function(){c.data.location=null;c.data.location_status=SurveyResponseModel.LocationStatus.UNAVAILABLE;c.save();a&&a(!1)})};c.respond=function(a,b,d){c.data._responses[a]={value:b,isImage:d};c.save()};c.promptSkipped=function(a){c.respond(a,SurveyResponseModel.SKIPPED_PROMPT_VALUE,!1)};c.promptNotDisplayed=function(a){c.respond(a,SurveyResponseModel.NOT_DISPLAYED_PROMPT_VALUE,!1)};c.submit=function(a){c.data.time=(new Date).getTime();c.save();"undefined"!==
typeof a&&a()};c.getImageIds=function(){var a=[],b,d;for(b in c.data._responses)d=c.data._responses[b],d.isImage&&a.push(d.value);return a};c.getUploadData=function(){var a=[],b={},d,i;for(d in c.data._responses)if(i=c.data._responses[d],a.push({prompt_id:d,value:i.value}),i.isImage){var j=SurveyResponseModel.getImage(i.value);b[i.value]=j.substring(j.indexOf(",")+1)}a={survey_key:c.data.survey_key,time:c.data.time,timezone:c.data.timezone,location_status:c.data.location_status,survey_id:c.data.survey_id,
survey_launch_context:c.data.survey_launch_context,responses:a};null!==c.data.location&&(a.location=c.data.location);return{responses:a,images:b}};c.setData=function(a){c.data=a};c.getResponses=function(){var a={},b;for(b in c.data._responses)a[b]=c.data._responses[b].value;return a};c.save=function(){SurveyResponseModel.saveSurveyResponse(c)};c.getResponse=function(a){return c.data._responses[a]?c.data._responses[a].value:null};c.getData=function(){return c.data};c.getLocationStatus=function(){return c.data.location_status};
c.getLocation=function(){return c.data.location};c.getSurveyID=function(){return c.data.survey_id};c.getSurveyKey=function(){return c.data.survey_key};c.isSubmitted=function(){return null===c.data.time?!1:!0};c.getSubmitDateString=function(){return c.getSubmitDate().toString().substr(0,24)};c.getSubmitDate=function(){return new Date(c.data.time)};c.getCampaignURN=function(){return c.data.campaign_urn};return c};SurveyResponseModel.responses=new LocalMap("suvey-responses");
SurveyResponseModel.init=function(a,b){return new SurveyResponseModel(a,UUIDGen.generate(),b)};SurveyResponseModel.saveSurveyResponse=function(a){SurveyResponseModel.responses.set(a.getSurveyKey(),a.getData())};SurveyResponseModel.LocationStatus={UNAVAILABLE:"unavailable",VALID:"valid",INACCURATE:"inaccurate",STALE:"stale"};
SurveyResponseModel.restoreSurveyResponse=function(a){a=SurveyResponseModel.responses.get(a);if(null===a)return!1;var b=new SurveyResponseModel(a.id,a.survey_key,a.campaign_urn);b.setData(a);return b};SurveyResponseModel.deleteSurveyResponse=function(a){var b=a.getImageIds(),d;for(d=0;d<b.length;d+=1)SurveyResponseModel.deleteImage(b[d]);SurveyResponseModel.responses.release(a.getSurveyKey())};
SurveyResponseModel.saveImage=function(a){var b=SurveyResponseModel.getImages(),d=UUIDGen.generate();b[d]=a;SurveyResponseModel.setImages(b);return d};SurveyResponseModel.getImage=function(a){return SurveyResponseModel.getImages()[a]};SurveyResponseModel.deleteImage=function(a){var b=SurveyResponseModel.getImages();b[a]&&delete b[a];SurveyResponseModel.setImages(b)};SurveyResponseModel.setImages=function(a){window.localStorage.images=window.JSON.stringify(a)};
SurveyResponseModel.getImages=function(){return window.localStorage.images?window.JSON.parse(window.localStorage.images):{}};SurveyResponseModel.getPendingResponses=function(){var a={},b,d;for(b in SurveyResponseModel.responses.getMap())if(d=SurveyResponseModel.restoreSurveyResponse(b),d.isSubmitted()){var c=CampaignsModel.getCampaign(d.getCampaignURN()).getSurvey(d.getSurveyID());a[b]={survey:c,response:d}}return a};
SurveyResponseModel.getUploadQueueSize=function(){var a=0,b,d;for(b in SurveyResponseModel.responses.getMap())d=SurveyResponseModel.restoreSurveyResponse(b),d.isSubmitted()&&(a+=1);return a};SurveyResponseModel.SKIPPED_PROMPT_VALUE="SKIPPED";SurveyResponseModel.NOT_DISPLAYED_PROMPT_VALUE="NOT_DISPLAYED";
var ConditionalParser=function(){function a(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var b={parse:function(b,c,g){function f(a){m<z||(m>z&&(z=m,V=[]),V.push(a))}function h(){var a,b,c,d,f;f=d=m;a=i();null!==a?(b=p(),null!==b?(c=i(),null!==c?a=[a,b,c]:(a=null,m=f)):(a=null,m=f)):(a=null,m=f);null!==a&&(a=v(a[0],a[1],a[2]));
null===a&&(m=d);null===a&&(f=d=m,a=i(),null!==a?(b=p(),null!==b?(c=j(),null!==c?a=[a,b,c]:(a=null,m=f)):(a=null,m=f)):(a=null,m=f),null!==a&&(a=v(a[0],a[1],a[2])),null===a&&(m=d),null===a&&(f=d=m,a=j(),null!==a?(b=p(),null!==b?(c=i(),null!==c?a=[a,b,c]:(a=null,m=f)):(a=null,m=f)):(a=null,m=f),null!==a&&(a=v(a[0],a[1],a[2])),null===a&&(m=d),null===a&&(f=d=m,a=j(),null!==a?(b=p(),null!==b?(c=j(),null!==c?a=[a,b,c]:(a=null,m=f)):(a=null,m=f)):(a=null,m=f),null!==a&&(a=v(a[0],a[1],a[2])),null===a&&(m=
d),null===a&&(a=i(),null===a&&(a=j())))));return a}function i(){var a,c,g,v,i;i=v=m;40===b.charCodeAt(m)?(a="(",m++):(a=null,0===s&&f('"("'));null!==a?(c=h(),null!==c?(41===b.charCodeAt(m)?(g=")",m++):(g=null,0===s&&f('")"')),null!==g?a=[a,c,g]:(a=null,m=i)):(a=null,m=i)):(a=null,m=i);null!==a&&(a=a[1]);null===a&&(m=v);return a}function j(){var a,b,d,f,g;g=f=m;a=k();null!==a?(b=n(),null!==b?(d=q(),null!==d?a=[a,b,d]:(a=null,m=g)):(a=null,m=g)):(a=null,m=g);null!==a&&(a=r(c[a[0]],a[1],a[2]));null===
a&&(m=f);return a}function k(){var a,c,g;g=m;/^[a-zA-Z0-9_]/.test(b.charAt(m))?(c=b.charAt(m),m++):(c=null,0===s&&f("[a-zA-Z0-9_]"));if(null!==c)for(a=[];null!==c;)a.push(c),/^[a-zA-Z0-9_]/.test(b.charAt(m))?(c=b.charAt(m),m++):(c=null,0===s&&f("[a-zA-Z0-9_]"));else a=null;null!==a&&(a=a.join(""));null===a&&(m=g);return a}function n(){var a;" == "===b.substr(m,4)?(a=" == ",m+=4):(a=null,0===s&&f('" == "'));null===a&&(" != "===b.substr(m,4)?(a=" != ",m+=4):(a=null,0===s&&f('" != "')),null===a&&(" > "===
b.substr(m,3)?(a=" > ",m+=3):(a=null,0===s&&f('" > "')),null===a&&(" < "===b.substr(m,3)?(a=" < ",m+=3):(a=null,0===s&&f('" < "')),null===a&&(" >= "===b.substr(m,4)?(a=" >= ",m+=4):(a=null,0===s&&f('" >= "')),null===a&&(" <= "===b.substr(m,4)?(a=" <= ",m+=4):(a=null,0===s&&f('" <= "')))))));return a}function q(){var a,c,g;g=m;/^[a-zA-Z0-9_]/.test(b.charAt(m))?(c=b.charAt(m),m++):(c=null,0===s&&f("[a-zA-Z0-9_]"));if(null!==c)for(a=[];null!==c;)a.push(c),/^[a-zA-Z0-9_]/.test(b.charAt(m))?(c=b.charAt(m),
m++):(c=null,0===s&&f("[a-zA-Z0-9_]"));else a=null;null!==a&&(a=a.join(""));null===a&&(m=g);return a}function p(){var a;" and "===b.substr(m,5)?(a=" and ",m+=5):(a=null,0===s&&f('" and "'));null===a&&(" or "===b.substr(m,4)?(a=" or ",m+=4):(a=null,0===s&&f('" or "')));return a}function t(a){a.sort();for(var b=null,c=[],d=0;d<a.length;d++)a[d]!==b&&(c.push(a[d]),b=a[d]);return c}function r(a,b,c){switch(b.replace(/^\s*([\S\s]*?)\s*$/,"$1")){case "==":return a==c;case "!=":return a!=c;case ">":return a>
c;case "<":return a<c;case ">=":return a>=c;case "<=":return a<=c;default:return!1}}function v(a,b,c){switch(b.replace(/^\s*([\S\s]*?)\s*$/,"$1")){case "and":return a&&c;case "or":return a||c}}var x={statement:function(){var a,b,c,d,f;f=d=m;a=h();null!==a?(b=p(),null!==b?(c=h(),null!==c?a=[a,b,c]:(a=null,m=f)):(a=null,m=f)):(a=null,m=f);null!==a&&(a=v(a[0],a[1],a[2]));null===a&&(m=d);null===a&&(a=h());return a},sentence:h,parenthetical:i,expression:j,id:k,condition:n,value:q,conjunction:p};if(void 0!==
g){if(void 0===x[g])throw Error("Invalid rule name: "+a(g)+".");}else g="statement";var m=0,s=0,z=0,V=[],g=x[g]();if(null===g||m!==b.length){for(var g=Math.max(m,z),x=g<b.length?b.charAt(g):null,W=1,w=1,C=!1,D=0;D<Math.max(m,z);D++){var E=b.charAt(D);"\n"===E?(C||W++,w=1,C=!1):"\r"===E||"\u2028"===E||"\u2029"===E?(W++,w=1,C=!0):(w++,C=!1)}throw new this.SyntaxError(t(V),x,g,W,w);}return g},toSource:function(){return this._source},SyntaxError:function(b,c,g,f,h){this.name="SyntaxError";this.expected=
b;this.found=c;switch(b.length){case 0:b="end of input";break;case 1:b=b[0];break;default:b=b.slice(0,b.length-1).join(", ")+" or "+b[b.length-1]}c=c?a(c):"end of input";this.message="Expected "+b+" but "+c+" found.";this.offset=g;this.line=f;this.column=h}};b.SyntaxError.prototype=Error.prototype;return b}(),PEG=function(a){function b(b,c){c===a&&(c=b,b=0);for(var d=Array(Math.max(0,c-b)),f=0,g=b;g<c;f++,g++)d[f]=g;return d}function d(a,b){for(var c=a.length,d=0;d<c;d++)b(a[d],d)}function c(a,b){for(var c=
[],d=a.length,f=0;f<d;f++)c[f]=b(a[f],f);return c}function g(a,b){return c(a,function(a){return a[b]})}function f(a){var b=[],c;for(c in a)b.push(c);return b}function h(a){var b=[],c;for(c in a)b.push(a[c]);return b}function i(a){var b=a.charCodeAt(0),c;255>=b?(a="x",c=2):(a="u",c=4);var a="\\"+a,d=b.toString(16).toUpperCase(),b=d;c-=d.length;for(d=0;d<c;d++)b="0"+b;return a+b}function j(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,
"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,i)+'"'}function k(a){return a.replace(/\\/g,"\\\\").replace(/\//g,"\\/").replace(/\]/g,"\\]").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\v/g,"\\x0B").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x01-\x08\x0E-\x1F\x80-\uFFFF]/g,i)}function n(a){return function(b){return a[b.type].apply(null,arguments)}}function q(a,b){var c;a:{c=a.rules;for(var d=
c.length,f=0;f<d;f++)if(c[f].name===b){c=c[f];break a}c=void 0}return c}var p={VERSION:"0.7.0",buildParser:function(a,b){return p.compiler.compile(p.parser.parse(a),b)},GrammarError:function(a){this.name="PEG.GrammarError";this.message=a}};p.GrammarError.prototype=Error.prototype;var t=function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,
i)+'"'},r={parse:function(b,d){function f(a){e<H||(e>H&&(H=e,Y=[]),Y.push(a))}function g(){var a,b,c,d;d=c=e;a=r();null!==a?(b=Z(),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,e=d)):(a=null,e=d);null!==a&&(a={type:"initializer",code:a[0]});null===a&&(e=c);return a}function h(){var a,b,c,d,f,g,j;j=g=e;a=K();null!==a?(b=aa(),b=null!==b?b:"",null!==b?(c=X(),null!==c?(d=i(),null!==d?(f=Z(),f=null!==f?f:"",null!==f?a=[a,b,c,d,f]:(a=null,e=j)):(a=null,e=j)):(a=null,e=j)):(a=null,e=j)):(a=null,e=j);null!==a&&
(a={type:"rule",name:a[0],displayName:""!==a[1]?a[1]:null,expression:a[3]});null===a&&(e=g);return a}function i(){var a,b,d,f,g,h,m;h=g=e;a=j();if(null!==a){b=[];m=e;d=ba();null!==d?(f=j(),null!==f?d=[d,f]:(d=null,e=m)):(d=null,e=m);for(;null!==d;)b.push(d),m=e,d=ba(),null!==d?(f=j(),null!==f?d=[d,f]:(d=null,e=m)):(d=null,e=m);null!==b?a=[a,b]:(a=null,e=h)}else a=null,e=h;null!==a&&(a=0<a[1].length?{type:"choice",alternatives:[a[0]].concat(c(a[1],function(a){return a[1]}))}:a[0]);null===a&&(e=g);
return a}function j(){var a,b,c,d;d=c=e;a=[];for(b=w();null!==b;)a.push(b),b=w();null!==a?(b=r(),null!==b?a=[a,b]:(a=null,e=d)):(a=null,e=d);null!==a&&(a={type:"action",expression:1!==a[0].length?{type:"sequence",elements:a[0]}:a[0][0],code:a[1]});null===a&&(e=c);if(null===a){c=e;a=[];for(b=w();null!==b;)a.push(b),b=w();null!==a&&(a=1!==a.length?{type:"sequence",elements:a}:a[0]);null===a&&(e=c)}return a}function w(){var a,b,c,d,f;f=d=e;a=K();null!==a?(b=oa(),null!==b?(c=n(),null!==c?a=[a,b,c]:(a=
null,e=f)):(a=null,e=f)):(a=null,e=f);null!==a&&(a={type:"labeled",label:a[0],expression:a[2]});null===a&&(e=d);null===a&&(a=n());return a}function n(){var a,b,c,d;d=c=e;a=ca();null!==a?(b=r(),null!==b?a=[a,b]:(a=null,e=d)):(a=null,e=d);null!==a&&(a={type:"semantic_and",code:a[1]});null===a&&(e=c);null===a&&(d=c=e,a=ca(),null!==a?(b=q(),null!==b?a=[a,b]:(a=null,e=d)):(a=null,e=d),null!==a&&(a={type:"simple_and",expression:a[1]}),null===a&&(e=c),null===a&&(d=c=e,a=da(),null!==a?(b=r(),null!==b?a=[a,
b]:(a=null,e=d)):(a=null,e=d),null!==a&&(a={type:"semantic_not",code:a[1]}),null===a&&(e=c),null===a&&(d=c=e,a=da(),null!==a?(b=q(),null!==b?a=[a,b]:(a=null,e=d)):(a=null,e=d),null!==a&&(a={type:"simple_not",expression:a[1]}),null===a&&(e=c),null===a&&(a=q()))));return a}function q(){var a,b,c,d;d=c=e;a=p();null!==a?(b=pa(),null!==b?a=[a,b]:(a=null,e=d)):(a=null,e=d);null!==a&&(a={type:"optional",expression:a[0]});null===a&&(e=c);null===a&&(d=c=e,a=p(),null!==a?(b=qa(),null!==b?a=[a,b]:(a=null,e=
d)):(a=null,e=d),null!==a&&(a={type:"zero_or_more",expression:a[0]}),null===a&&(e=c),null===a&&(d=c=e,a=p(),null!==a?(b=ra(),null!==b?a=[a,b]:(a=null,e=d)):(a=null,e=d),null!==a&&(a={type:"one_or_more",expression:a[0]}),null===a&&(e=c),null===a&&(a=p())));return a}function p(){var a,b,c,d,f,g,h;f=d=e;a=K();null!==a?(g=e,l++,h=e,b=aa(),b=null!==b?b:"",null!==b?(c=X(),null!==c?b=[b,c]:(b=null,e=h)):(b=null,e=h),l--,null===b?b="":(b=null,e=g),null!==b?a=[a,b]:(a=null,e=f)):(a=null,e=f);null!==a&&(a=
{type:"rule_ref",name:a[0]});null===a&&(e=d);null===a&&(a=sa(),null===a&&(d=e,a=ta(),null!==a&&(a={type:"any"}),null===a&&(e=d),null===a&&(a=ua(),null===a&&(f=d=e,a=va(),null!==a?(b=i(),null!==b?(c=wa(),null!==c?a=[a,b,c]:(a=null,e=f)):(a=null,e=f)):(a=null,e=f),null!==a&&(a=a[1]),null===a&&(e=d)))));return a}function r(){var a,b,c,d;l++;d=c=e;a=B();null!==a?(b=u(),null!==b?a=[a,b]:(a=null,e=d)):(a=null,e=d);null!==a&&(a=a[0].substr(1,a[0].length-2));null===a&&(e=c);l--;0===l&&null===a&&f("action");
return a}function B(){var a,c,d,g,h;h=g=e;123===b.charCodeAt(e)?(a="{",e++):(a=null,0===l&&f('"{"'));if(null!==a){c=[];d=B();for(null===d&&(d=y());null!==d;)c.push(d),d=B(),null===d&&(d=y());null!==c?(125===b.charCodeAt(e)?(d="}",e++):(d=null,0===l&&f('"}"')),null!==d?a=[a,c,d]:(a=null,e=h)):(a=null,e=h)}else a=null,e=h;null!==a&&(a="{"+a[1].join("")+"}");null===a&&(e=g);return a}function y(){var a;/^[^{}]/.test(b.charAt(e))?(a=b.charAt(e),e++):(a=null,0===l&&f("[^{}]"));return a}function X(){var a,
c,d,g;g=d=e;61===b.charCodeAt(e)?(a="=",e++):(a=null,0===l&&f('"="'));null!==a?(c=u(),null!==c?a=[a,c]:(a=null,e=g)):(a=null,e=g);null!==a&&(a="=");null===a&&(e=d);return a}function oa(){var a,c,d,g;g=d=e;58===b.charCodeAt(e)?(a=":",e++):(a=null,0===l&&f('":"'));null!==a?(c=u(),null!==c?a=[a,c]:(a=null,e=g)):(a=null,e=g);null!==a&&(a=":");null===a&&(e=d);return a}function Z(){var a,c,d,g;g=d=e;59===b.charCodeAt(e)?(a=";",e++):(a=null,0===l&&f('";"'));null!==a?(c=u(),null!==c?a=[a,c]:(a=null,e=g)):
(a=null,e=g);null!==a&&(a=";");null===a&&(e=d);return a}function ba(){var a,c,d,g;g=d=e;47===b.charCodeAt(e)?(a="/",e++):(a=null,0===l&&f('"/"'));null!==a?(c=u(),null!==c?a=[a,c]:(a=null,e=g)):(a=null,e=g);null!==a&&(a="/");null===a&&(e=d);return a}function ca(){var a,c,d,g;g=d=e;38===b.charCodeAt(e)?(a="&",e++):(a=null,0===l&&f('"&"'));null!==a?(c=u(),null!==c?a=[a,c]:(a=null,e=g)):(a=null,e=g);null!==a&&(a="&");null===a&&(e=d);return a}function da(){var a,c,d,g;g=d=e;33===b.charCodeAt(e)?(a="!",
e++):(a=null,0===l&&f('"!"'));null!==a?(c=u(),null!==c?a=[a,c]:(a=null,e=g)):(a=null,e=g);null!==a&&(a="!");null===a&&(e=d);return a}function pa(){var a,c,d,g;g=d=e;63===b.charCodeAt(e)?(a="?",e++):(a=null,0===l&&f('"?"'));null!==a?(c=u(),null!==c?a=[a,c]:(a=null,e=g)):(a=null,e=g);null!==a&&(a="?");null===a&&(e=d);return a}function qa(){var a,c,d,g;g=d=e;42===b.charCodeAt(e)?(a="*",e++):(a=null,0===l&&f('"*"'));null!==a?(c=u(),null!==c?a=[a,c]:(a=null,e=g)):(a=null,e=g);null!==a&&(a="*");null===
a&&(e=d);return a}function ra(){var a,c,d,g;g=d=e;43===b.charCodeAt(e)?(a="+",e++):(a=null,0===l&&f('"+"'));null!==a?(c=u(),null!==c?a=[a,c]:(a=null,e=g)):(a=null,e=g);null!==a&&(a="+");null===a&&(e=d);return a}function va(){var a,c,d,g;g=d=e;40===b.charCodeAt(e)?(a="(",e++):(a=null,0===l&&f('"("'));null!==a?(c=u(),null!==c?a=[a,c]:(a=null,e=g)):(a=null,e=g);null!==a&&(a="(");null===a&&(e=d);return a}function wa(){var a,c,d,g;g=d=e;41===b.charCodeAt(e)?(a=")",e++):(a=null,0===l&&f('")"'));null!==
a?(c=u(),null!==c?a=[a,c]:(a=null,e=g)):(a=null,e=g);null!==a&&(a=")");null===a&&(e=d);return a}function ta(){var a,c,d,g;g=d=e;46===b.charCodeAt(e)?(a=".",e++):(a=null,0===l&&f('"."'));null!==a?(c=u(),null!==c?a=[a,c]:(a=null,e=g)):(a=null,e=g);null!==a&&(a=".");null===a&&(e=d);return a}function K(){var a,c,d,g,h;l++;h=g=e;a=L();null===a&&(95===b.charCodeAt(e)?(a="_",e++):(a=null,0===l&&f('"_"')),null===a&&(36===b.charCodeAt(e)?(a="$",e++):(a=null,0===l&&f('"$"'))));if(null!==a){c=[];d=L();null===
d&&(d=I(),null===d&&(95===b.charCodeAt(e)?(d="_",e++):(d=null,0===l&&f('"_"')),null===d&&(36===b.charCodeAt(e)?(d="$",e++):(d=null,0===l&&f('"$"')))));for(;null!==d;)c.push(d),d=L(),null===d&&(d=I(),null===d&&(95===b.charCodeAt(e)?(d="_",e++):(d=null,0===l&&f('"_"')),null===d&&(36===b.charCodeAt(e)?(d="$",e++):(d=null,0===l&&f('"$"')))));null!==c?(d=u(),null!==d?a=[a,c,d]:(a=null,e=h)):(a=null,e=h)}else a=null,e=h;null!==a&&(a=a[0]+a[1].join(""));null===a&&(e=g);l--;0===l&&null===a&&f("identifier");
return a}function sa(){var a,c,d,g,h;l++;h=g=e;a=ea();null===a&&(a=fa());null!==a?(105===b.charCodeAt(e)?(c="i",e++):(c=null,0===l&&f('"i"')),c=null!==c?c:"",null!==c?(d=u(),null!==d?a=[a,c,d]:(a=null,e=h)):(a=null,e=h)):(a=null,e=h);null!==a&&(a={type:"literal",value:a[0],ignoreCase:"i"===a[1]});null===a&&(e=g);l--;0===l&&null===a&&f("literal");return a}function aa(){var a,b,c,d;l++;d=c=e;a=ea();null===a&&(a=fa());null!==a?(b=u(),null!==b?a=[a,b]:(a=null,e=d)):(a=null,e=d);null!==a&&(a=a[0]);null===
a&&(e=c);l--;0===l&&null===a&&f("string");return a}function ea(){var a,c,d,g,h;h=g=e;34===b.charCodeAt(e)?(a='"',e++):(a=null,0===l&&f('"\\""'));if(null!==a){c=[];for(d=ga();null!==d;)c.push(d),d=ga();null!==c?(34===b.charCodeAt(e)?(d='"',e++):(d=null,0===l&&f('"\\""')),null!==d?a=[a,c,d]:(a=null,e=h)):(a=null,e=h)}else a=null,e=h;null!==a&&(a=a[1].join(""));null===a&&(e=g);return a}function ga(){var a;a=xa();null===a&&(a=M(),null===a&&(a=N(),null===a&&(a=O(),null===a&&(a=P(),null===a&&(a=Q())))));
return a}function xa(){var a,c,d,g;c=g=d=e;l++;34===b.charCodeAt(e)?(a='"',e++):(a=null,0===l&&f('"\\""'));null===a&&(92===b.charCodeAt(e)?(a="\\",e++):(a=null,0===l&&f('"\\\\"')),null===a&&(a=F()));l--;null===a?a="":(a=null,e=c);null!==a?(b.length>e?(c=b.charAt(e),e++):(c=null,0===l&&f("any character")),null!==c?a=[a,c]:(a=null,e=g)):(a=null,e=g);null!==a&&(a=a[1]);null===a&&(e=d);return a}function fa(){var a,c,d,g,h;h=g=e;39===b.charCodeAt(e)?(a="'",e++):(a=null,0===l&&f('"\'"'));if(null!==a){c=
[];for(d=ha();null!==d;)c.push(d),d=ha();null!==c?(39===b.charCodeAt(e)?(d="'",e++):(d=null,0===l&&f('"\'"')),null!==d?a=[a,c,d]:(a=null,e=h)):(a=null,e=h)}else a=null,e=h;null!==a&&(a=a[1].join(""));null===a&&(e=g);return a}function ha(){var a;a=ya();null===a&&(a=M(),null===a&&(a=N(),null===a&&(a=O(),null===a&&(a=P(),null===a&&(a=Q())))));return a}function ya(){var a,c,d,g;c=g=d=e;l++;39===b.charCodeAt(e)?(a="'",e++):(a=null,0===l&&f('"\'"'));null===a&&(92===b.charCodeAt(e)?(a="\\",e++):(a=null,
0===l&&f('"\\\\"')),null===a&&(a=F()));l--;null===a?a="":(a=null,e=c);null!==a?(b.length>e?(c=b.charAt(e),e++):(c=null,0===l&&f("any character")),null!==c?a=[a,c]:(a=null,e=g)):(a=null,e=g);null!==a&&(a=a[1]);null===a&&(e=d);return a}function ua(){var a,d,g,h,i,j,k,y;l++;y=k=e;91===b.charCodeAt(e)?(a="[",e++):(a=null,0===l&&f('"["'));if(null!==a)if(94===b.charCodeAt(e)?(d="^",e++):(d=null,0===l&&f('"^"')),d=null!==d?d:"",null!==d){g=[];h=ia();for(null===h&&(h=J());null!==h;)g.push(h),h=ia(),null===
h&&(h=J());null!==g?(93===b.charCodeAt(e)?(h="]",e++):(h=null,0===l&&f('"]"')),null!==h?(105===b.charCodeAt(e)?(i="i",e++):(i=null,0===l&&f('"i"')),i=null!==i?i:"",null!==i?(j=u(),null!==j?a=[a,d,g,h,i,j]:(a=null,e=y)):(a=null,e=y)):(a=null,e=y)):(a=null,e=y)}else a=null,e=y;else a=null,e=y;null!==a&&(d=a[1],g=a[2],a=a[4],h=c(g,function(a){return a.data}),g="["+d+c(g,function(a){return a.rawText}).join("")+"]"+a,a={type:"class",inverted:"^"===d,ignoreCase:"i"===a,parts:h,rawText:g});null===a&&(e=
k);l--;0===l&&null===a&&f("character class");return a}function ia(){var a,c,d,g,h;h=g=e;a=J();null!==a?(45===b.charCodeAt(e)?(c="-",e++):(c=null,0===l&&f('"-"')),null!==c?(d=J(),null!==d?a=[a,c,d]:(a=null,e=h)):(a=null,e=h)):(a=null,e=h);null!==a&&(a=function(a,b,c){if(b.data.charCodeAt(0)>c.data.charCodeAt(0))throw new this.SyntaxError("Invalid character range: "+b.rawText+"-"+c.rawText+".");return{data:[b.data,c.data],rawText:b.rawText+"-"+c.rawText}}(g,a[0],a[2]));null===a&&(e=g);return a}function J(){var a,
b;b=e;a=za();null!==a&&(a={data:a,rawText:k(a)});null===a&&(e=b);return a}function za(){var a;a=Aa();null===a&&(a=M(),null===a&&(a=N(),null===a&&(a=O(),null===a&&(a=P(),null===a&&(a=Q())))));return a}function Aa(){var a,c,d,g;c=g=d=e;l++;93===b.charCodeAt(e)?(a="]",e++):(a=null,0===l&&f('"]"'));null===a&&(92===b.charCodeAt(e)?(a="\\",e++):(a=null,0===l&&f('"\\\\"')),null===a&&(a=F()));l--;null===a?a="":(a=null,e=c);null!==a?(b.length>e?(c=b.charAt(e),e++):(c=null,0===l&&f("any character")),null!==
c?a=[a,c]:(a=null,e=g)):(a=null,e=g);null!==a&&(a=a[1]);null===a&&(e=d);return a}function M(){var a,c,d,g,h;h=g=e;92===b.charCodeAt(e)?(a="\\",e++):(a=null,0===l&&f('"\\\\"'));null!==a?(d=e,l++,c=I(),null===c&&(120===b.charCodeAt(e)?(c="x",e++):(c=null,0===l&&f('"x"')),null===c&&(117===b.charCodeAt(e)?(c="u",e++):(c=null,0===l&&f('"u"')),null===c&&(c=F()))),l--,null===c?c="":(c=null,e=d),null!==c?(b.length>e?(d=b.charAt(e),e++):(d=null,0===l&&f("any character")),null!==d?a=[a,c,d]:(a=null,e=h)):(a=
null,e=h)):(a=null,e=h);null!==a&&(a=a[2].replace("b","\b").replace("f","\f").replace("n","\n").replace("r","\r").replace("t","\t").replace("v","\x0B"));null===a&&(e=g);return a}function N(){var a,c,d,g,h;g=d=e;"\\0"===b.substr(e,2)?(a="\\0",e+=2):(a=null,0===l&&f('"\\\\0"'));null!==a?(h=e,l++,c=I(),l--,null===c?c="":(c=null,e=h),null!==c?a=[a,c]:(a=null,e=g)):(a=null,e=g);null!==a&&(a="\x00");null===a&&(e=d);return a}function O(){var a,c,d,g,h;h=g=e;"\\x"===b.substr(e,2)?(a="\\x",e+=2):(a=null,0===
l&&f('"\\\\x"'));null!==a?(c=G(),null!==c?(d=G(),null!==d?a=[a,c,d]:(a=null,e=h)):(a=null,e=h)):(a=null,e=h);null!==a&&(a=String.fromCharCode(parseInt(a[1]+a[2],16)));null===a&&(e=g);return a}function P(){var a,c,d,g,h,i,j;j=i=e;"\\u"===b.substr(e,2)?(a="\\u",e+=2):(a=null,0===l&&f('"\\\\u"'));null!==a?(c=G(),null!==c?(d=G(),null!==d?(g=G(),null!==g?(h=G(),null!==h?a=[a,c,d,g,h]:(a=null,e=j)):(a=null,e=j)):(a=null,e=j)):(a=null,e=j)):(a=null,e=j);null!==a&&(a=String.fromCharCode(parseInt(a[1]+a[2]+
a[3]+a[4],16)));null===a&&(e=i);return a}function Q(){var a,c,d,g;g=d=e;92===b.charCodeAt(e)?(a="\\",e++):(a=null,0===l&&f('"\\\\"'));null!==a?(c=R(),null!==c?a=[a,c]:(a=null,e=g)):(a=null,e=g);null!==a&&(a=a[1]);null===a&&(e=d);return a}function I(){var a;/^[0-9]/.test(b.charAt(e))?(a=b.charAt(e),e++):(a=null,0===l&&f("[0-9]"));return a}function G(){var a;/^[0-9a-fA-F]/.test(b.charAt(e))?(a=b.charAt(e),e++):(a=null,0===l&&f("[0-9a-fA-F]"));return a}function L(){var a;a=Ba();null===a&&(a=Ca());return a}
function Ba(){var a;/^[a-z]/.test(b.charAt(e))?(a=b.charAt(e),e++):(a=null,0===l&&f("[a-z]"));return a}function Ca(){var a;/^[A-Z]/.test(b.charAt(e))?(a=b.charAt(e),e++):(a=null,0===l&&f("[A-Z]"));return a}function u(){var a,b;a=[];b=ja();null===b&&(b=R(),null===b&&(b=ka()));for(;null!==b;)a.push(b),b=ja(),null===b&&(b=R(),null===b&&(b=ka()));return a}function ka(){var a;l++;a=Da();null===a&&(a=Ea());l--;0===l&&null===a&&f("comment");return a}function Da(){var a,c,d,g,h,i;h=e;"//"===b.substr(e,2)?
(a="//",e+=2):(a=null,0===l&&f('"//"'));if(null!==a){c=[];g=i=e;l++;d=F();l--;null===d?d="":(d=null,e=g);null!==d?(b.length>e?(g=b.charAt(e),e++):(g=null,0===l&&f("any character")),null!==g?d=[d,g]:(d=null,e=i)):(d=null,e=i);for(;null!==d;)c.push(d),g=i=e,l++,d=F(),l--,null===d?d="":(d=null,e=g),null!==d?(b.length>e?(g=b.charAt(e),e++):(g=null,0===l&&f("any character")),null!==g?d=[d,g]:(d=null,e=i)):(d=null,e=i);null!==c?a=[a,c]:(a=null,e=h)}else a=null,e=h;return a}function Ea(){var a,c,d,g,h,i;
h=e;"/*"===b.substr(e,2)?(a="/*",e+=2):(a=null,0===l&&f('"/*"'));if(null!==a){c=[];g=i=e;l++;"*/"===b.substr(e,2)?(d="*/",e+=2):(d=null,0===l&&f('"*/"'));l--;null===d?d="":(d=null,e=g);null!==d?(b.length>e?(g=b.charAt(e),e++):(g=null,0===l&&f("any character")),null!==g?d=[d,g]:(d=null,e=i)):(d=null,e=i);for(;null!==d;)c.push(d),g=i=e,l++,"*/"===b.substr(e,2)?(d="*/",e+=2):(d=null,0===l&&f('"*/"')),l--,null===d?d="":(d=null,e=g),null!==d?(b.length>e?(g=b.charAt(e),e++):(g=null,0===l&&f("any character")),
null!==g?d=[d,g]:(d=null,e=i)):(d=null,e=i);null!==c?("*/"===b.substr(e,2)?(d="*/",e+=2):(d=null,0===l&&f('"*/"')),null!==d?a=[a,c,d]:(a=null,e=h)):(a=null,e=h)}else a=null,e=h;return a}function R(){var a;l++;10===b.charCodeAt(e)?(a="\n",e++):(a=null,0===l&&f('"\\n"'));null===a&&("\r\n"===b.substr(e,2)?(a="\r\n",e+=2):(a=null,0===l&&f('"\\r\\n"')),null===a&&(13===b.charCodeAt(e)?(a="\r",e++):(a=null,0===l&&f('"\\r"')),null===a&&(8232===b.charCodeAt(e)?(a="\u2028",e++):(a=null,0===l&&f('"\\u2028"')),
null===a&&(8233===b.charCodeAt(e)?(a="\u2029",e++):(a=null,0===l&&f('"\\u2029"'))))));l--;0===l&&null===a&&f("end of line");return a}function F(){var a;/^[\n\r\u2028\u2029]/.test(b.charAt(e))?(a=b.charAt(e),e++):(a=null,0===l&&f("[\\n\\r\\u2028\\u2029]"));return a}function ja(){var a;l++;/^[ \t\x0B\f\xA0\uFEFF\u1680\u180E\u2000-\u200A\u202F\u205F\u3000]/.test(b.charAt(e))?(a=b.charAt(e),e++):(a=null,0===l&&f("[ \\t\\x0B\\f\\xA0\\uFEFF\\u1680\\u180E\\u2000-\\u200A\\u202F\\u205F\\u3000]"));l--;0===
l&&null===a&&f("whitespace");return a}function Fa(a){a.sort();for(var b=null,c=[],d=0;d<a.length;d++)a[d]!==b&&(c.push(a[d]),b=a[d]);return c}var A={grammar:function(){var a,b,c,d,f,i;i=f=e;a=u();if(null!==a)if(b=g(),b=null!==b?b:"",null!==b){d=h();if(null!==d)for(c=[];null!==d;)c.push(d),d=h();else c=null;null!==c?a=[a,b,c]:(a=null,e=i)}else a=null,e=i;else a=null,e=i;null!==a&&(a={type:"grammar",initializer:""!==a[1]?a[1]:null,rules:a[2],startRule:a[2][0].name});null===a&&(e=f);return a},initializer:g,
rule:h,choice:i,sequence:j,labeled:w,prefixed:n,suffixed:q,primary:p,action:r,braced:B,nonBraceCharacters:function(){var a,b,c;c=e;b=y();if(null!==b)for(a=[];null!==b;)a.push(b),b=y();else a=null;null!==a&&(a=a.join(""));null===a&&(e=c);return a},nonBraceCharacter:y,equals:X,colon:oa,semicolon:Z,slash:ba,and:ca,not:da,question:pa,star:qa,plus:ra,lparen:va,rparen:wa,dot:ta,identifier:K,literal:sa,string:aa,doubleQuotedString:ea,doubleQuotedCharacter:ga,simpleDoubleQuotedCharacter:xa,singleQuotedString:fa,
singleQuotedCharacter:ha,simpleSingleQuotedCharacter:ya,"class":ua,classCharacterRange:ia,classCharacter:J,bracketDelimitedCharacter:za,simpleBracketDelimitedCharacter:Aa,simpleEscapeSequence:M,zeroEscapeSequence:N,hexEscapeSequence:O,unicodeEscapeSequence:P,eolEscapeSequence:Q,digit:I,hexDigit:G,letter:L,lowerCaseLetter:Ba,upperCaseLetter:Ca,__:u,comment:ka,singleLineComment:Da,multiLineComment:Ea,eol:R,eolChar:F,whitespace:ja};if(d!==a){if(A[d]===a)throw Error("Invalid rule name: "+t(d)+".");}else d=
"grammar";var e=0,l=0,H=0,Y=[],A=A[d]();if(null===A||e!==b.length){for(var A=Math.max(e,H),Ga=A<b.length?b.charAt(A):null,la=1,S=1,T=!1,ma=0;ma<Math.max(e,H);ma++){var U=b.charAt(ma);"\n"===U?(T||la++,S=1,T=!1):"\r"===U||"\u2028"===U||"\u2029"===U?(la++,S=1,T=!0):(S++,T=!1)}throw new this.SyntaxError(Fa(Y),Ga,A,la,S);}return A},toSource:function(){return this._source},SyntaxError:function(a,b,c,d,f){this.name="SyntaxError";this.expected=a;this.found=b;switch(a.length){case 0:a="end of input";break;
case 1:a=a[0];break;default:a=a.slice(0,a.length-1).join(", ")+" or "+a[a.length-1]}b=b?t(b):"end of input";this.message="Expected "+a+" but "+b+" found.";this.offset=c;this.line=d;this.column=f}};r.SyntaxError.prototype=Error.prototype;p.parser=r;p.compiler={appliedPassNames:["reportMissingRules","reportLeftRecursion","removeProxyRules","computeVarNames","computeParams"],compile:function(a,b){var c=this;d(this.appliedPassNames,function(b){c.passes[b](a)});var f=this.emitter(a,b),g=eval(f);g._source=
f;return g}};p.compiler.passes={reportMissingRules:function(a){function b(){}function c(a){g(a.expression)}function f(a){return function(b){d(b[a],g)}}var g=n({grammar:f("rules"),rule:c,choice:f("alternatives"),sequence:f("elements"),labeled:c,simple_and:c,simple_not:c,semantic_and:b,semantic_not:b,optional:c,zero_or_more:c,one_or_more:c,action:c,rule_ref:function(b){if(!q(a,b.name))throw new p.GrammarError('Referenced rule "'+b.name+'" does not exist.');},literal:b,any:b,"class":b});g(a)},reportLeftRecursion:function(a){function b(){}
function c(a,b){g(a.expression,b)}function f(a){return function(b,c){d(b[a],function(a){g(a,c)})}}var g=n({grammar:f("rules"),rule:function(a,b){g(a.expression,b.concat(a.name))},choice:f("alternatives"),sequence:function(a,b){0<a.elements.length&&g(a.elements[0],b)},labeled:c,simple_and:c,simple_not:c,semantic_and:b,semantic_not:b,optional:c,zero_or_more:c,one_or_more:c,action:c,rule_ref:function(b,c){var d;a:{d=c.length;for(var f=0;f<d;f++)if(c[f]===b.name){d=!0;break a}d=!1}if(d)throw new p.GrammarError('Left recursion detected for rule "'+
b.name+'".');g(q(a,b.name),c)},literal:b,any:b,"class":b});g(a,[])},removeProxyRules:function(a){var b=[];d(a.rules,function(c,f){if("rule"===c.type&&"rule_ref"===c.expression.type){var g=c.name,h=c.expression.name,i=function(){},j=function(a,b,c){p(a.expression,b,c)},k=function(a){return function(b,c,f){d(b[a],function(a){p(a,c,f)})}},p=n({grammar:k("rules"),rule:j,choice:k("alternatives"),sequence:k("elements"),labeled:j,simple_and:j,simple_not:j,semantic_and:i,semantic_not:i,optional:j,zero_or_more:j,
one_or_more:j,action:j,rule_ref:function(a,b,c){a.name===b&&(a.name=c)},literal:i,any:i,"class":i});p(a,g,h);c.name===a.startRule&&(a.startRule=c.expression.name);b.push(f)}});b.reverse();d(b,function(b){a.rules.splice(b,1)})},computeVarNames:function(a){function f(a){return"result"+a}function h(a){return"pos"+a}function i(a,b){a.resultVar=f(b.result);return{result:0,pos:0}}function j(a){return function(b,c){var d=k(b.expression,{result:c.result+a.result,pos:c.pos+a.pos});b.resultVar=f(c.result);
0!==a.pos&&(b.posVar=h(c.pos));return{result:d.result+a.result,pos:d.pos+a.pos}}}var k=n({grammar:function(a,b){d(a.rules,function(a){k(a,b)})},rule:function(a,d){var g=k(a.expression,d);a.resultVar=f(d.result);a.resultVars=c(b(g.result+1),f);a.posVars=c(b(g.pos),h)},choice:function(a,b){var d=c(a.alternatives,function(a){return k(a,b)});a.resultVar=f(b.result);return{result:Math.max.apply(null,g(d,"result")),pos:Math.max.apply(null,g(d,"pos"))}},sequence:function(a,b){var d=c(a.elements,function(a,
c){return k(a,{result:b.result+c,pos:b.pos+1})});a.resultVar=f(b.result);a.posVar=h(b.pos);return{result:0<a.elements.length?Math.max.apply(null,c(d,function(a,b){return b+a.result})):0,pos:0<a.elements.length?1+Math.max.apply(null,g(d,"pos")):1}},labeled:j({result:0,pos:0}),simple_and:j({result:0,pos:1}),simple_not:j({result:0,pos:1}),semantic_and:i,semantic_not:i,optional:j({result:0,pos:0}),zero_or_more:j({result:1,pos:0}),one_or_more:j({result:1,pos:0}),action:j({result:0,pos:1}),rule_ref:i,literal:i,
any:i,"class":i});k(a,{result:0,pos:0})},computeParams:function(a){function b(a){i.push({});a();i.pop()}function c(){}function f(a){b(function(){j(a.expression)})}function h(a){var b=i[i.length-1],c={},d;for(d in b)c[d]=b[d];a.params=c}var i=[],j=n({grammar:function(a){d(a.rules,j)},rule:f,choice:function(a){b(function(){d(a.alternatives,j)})},sequence:function(a){function b(f){d(g(a.elements,"resultVar"),function(b,d){RegExp("^"+b+"(\\[\\d+\\])*$").test(c[f])&&(c[f]=a.resultVar+"["+d+"]"+c[f].substr(b.length))})}
var c=i[i.length-1],f;d(a.elements,j);for(f in c)b(f)},labeled:function(a){i[i.length-1][a.label]=a.resultVar;b(function(){j(a.expression)})},simple_and:f,simple_not:f,semantic_and:h,semantic_not:h,optional:f,zero_or_more:f,one_or_more:f,action:function(a){b(function(){j(a.expression);h(a)})},rule_ref:c,literal:c,any:c,"class":c});j(a)}};p.compiler.emitter=function(b,d){function i(a,b){b.string=j;b.pluck=g;b.keys=f;b.values=h;b.emit=B;b.options=d;d.trackLineAndColumn?(b.posInit=function(a){return"var "+
a+" = { offset: 0, line: 1, column: 1, seenCR: false }"},b.posClone=function(a){return"clone("+a+")"},b.posOffset=function(a){return a+".offset"},b.posAdvance=function(a){return"advance(pos, "+a+")"}):(b.posInit=function(a){return"var "+a+" = 0"},b.posClone=function(a){return a},b.posOffset=function(a){return a},b.posAdvance=function(a){return 1===a?"pos++":"pos += "+a});b.posSave=function(a){return a.posVar+" = "+b.posClone("pos")};b.posRestore=function(a){return"pos = "+b.posClone(a.posVar)};return C[a](b)}
function p(a){return function(b){return i(a,{node:b})}}d=d||{};d.cache===a&&(d.cache=!1);d.trackLineAndColumn===a&&(d.trackLineAndColumn=!1);var q,r=function(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+
b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})},t=function(a,b,c){var a=a.substring(0,b),b=c.indentLevel(),d=c.atBOL,c=a.replace(RegExp("^.{"+b+"}","gm"),function(a,b){return 0===b?d?"":a:""}),c=r(c);return 0<c.length?"__p.push("+('"'+c+'"')+");":""},w={VERSION:"1.1.0",indentStep:2,commands:{"if":{params:/^(.*)$/,compile:function(a,b,c){return["if("+c[0]+"){",[]]},stackOp:"push"},"else":{params:/^$/,compile:function(a){var a=
a.commandStack,b="if"===a[a.length-1];if("else"===a[a.length-1])throw Error("Multiple #elses.");if(!b)throw Error("Using #else outside of #if.");return["}else{",[]]},stackOp:"replace"},"for":{params:/^([a-zA-Z_][a-zA-Z0-9_]*)[ \t]+in[ \t]+(.*)$/,init:function(a){a.forCurrLevel=0;a.forMaxLevel=0},compile:function(a,b,c){var b="__c"+a.forCurrLevel,d="__l"+a.forCurrLevel,f="__i"+a.forCurrLevel;a.forCurrLevel++;a.forMaxLevel<a.forCurrLevel&&(a.forMaxLevel=a.forCurrLevel);return[b+"="+c[1]+";"+d+"="+b+
".length;for("+f+"=0;"+f+"<"+d+";"+f+"++){"+c[0]+"="+b+"["+f+"];",[c[0],b,d,f]]},exit:function(a){a.forCurrLevel--},stackOp:"push"},end:{params:/^$/,compile:function(a){var b=a.commandStack;if(0===b.length)throw Error("Too many #ends.");(b=w.commands[b[b.length-1]].exit)&&b(a);return["}",[]]},stackOp:"pop"},block:{params:/^(.*)$/,compile:function(a,b,c){return['__x="'+r(b.substring(a.indentLevel()))+'";__n=('+c[0]+').toString().split("\\n");__l=__n.length;for(__i=0;__i<__l;__i++){__n[__i]=__x+__n[__i]+"\\n";}__p.push(__n.join(""));',
["__x","__n","__l","__i"]]},stackOp:"nop"}},template:function(a){var b={push:function(a,b){a.push(b)},replace:function(a,b){a[a.length-1]=b},pop:function(a){a.pop()},nop:function(){}},c={commandStack:[],atBOL:!0,indentLevel:function(){return w.indentStep*this.commandStack.length}},d="",f=["__p=[]"],g,h;for(g in w.commands)w.commands[g].init&&w.commands[g].init(c);for(;null!==(g=/^([ \t]*)#([a-zA-Z_][a-zA-Z0-9_]*)(?:[ \t]+([^ \t\n][^\n]*))?[ \t]*(?:\n|$)|#\{([^}]*)\}/m.exec(a));){d+=t(a,g.index,c);
if(void 0!==g[2]&&""!==g[2]){h=c;var i=g[1],j=g[2],k=g[3]||"",m=void 0,n=void 0,n=void 0,m=w.commands[j];if(!m)throw Error("Unknown command: #"+j+".");n=m.params.exec(k);if(null===n)throw Error("Invalid params for command #"+j+": "+k+".");n=m.compile(h,i,n.slice(1));b[m.stackOp](h.commandStack,j);h.atBOL=!0;h=n}else h=g[4],c.atBOL=!1,h=["__p.push("+h+");",[]];d+=h[0];f=f.concat(h[1]);a=a.substring(g.index+g[0].length)}d+=t(a,a.length,c);if(0<c.commandStack.length)throw Error("Missing #end.");f.sort();
for(a=0;a<f.length;a++)f[a]===f[a-1]&&f.splice(a--,1);return new Function("__v",["__v=__v||{};","var "+f.join(",")+";","with(__v){",d,'return __p.join("").replace(/^\\n+|\\n+$/g,"");};'].join(""))}};q=w;var C,D,E={},na={grammar:["(function(){","  /*","   * Generated by PEG.js 0.7.0.","   *","   * http://pegjs.majda.cz/","   */","  ","  function quote(s) {","    /*","     * ECMA-262, 5th ed., 7.8.4: All characters may appear literally in a","     * string literal except for the closing quote character, backslash,",
"     * carriage return, line separator, paragraph separator, and line feed.","     * Any character may appear in the form of an escape sequence.","     *","     * For portability, we also escape escape all control and non-ASCII",'     * characters. Note that "\\0" and "\\v" escape sequences are not used',"     * because JSHint does not like the first and IE the second.","     */","     return '\"' + s","      .replace(/\\\\/g, '\\\\\\\\')  // backslash","      .replace(/\"/g, '\\\\\"')    // closing quote character",
"      .replace(/\\x08/g, '\\\\b') // backspace","      .replace(/\\t/g, '\\\\t')   // horizontal tab","      .replace(/\\n/g, '\\\\n')   // line feed","      .replace(/\\f/g, '\\\\f')   // form feed","      .replace(/\\r/g, '\\\\r')   // carriage return","      .replace(/[\\x00-\\x07\\x0B\\x0E-\\x1F\\x80-\\uFFFF]/g, escape)","      + '\"';","  }","  ","  var result = {","    /*","     * Parses the input with a generated parser. If the parsing is successfull,","     * returns a value explicitly or implicitly specified by the grammar from",
"     * which the parser was generated (see |PEG.buildParser|). If the parsing is","     * unsuccessful, throws |PEG.parser.SyntaxError| describing the error.","     */","    parse: function(input, startRule) {","      var parseFunctions = {","        #for rule in node.rules",'          #{string(rule.name) + ": parse_" + rule.name + (rule !== node.rules[node.rules.length - 1] ? "," : "")}',"        #end","      };","      ","      if (startRule !== undefined) {","        if (parseFunctions[startRule] === undefined) {",
'          throw new Error("Invalid rule name: " + quote(startRule) + ".");',"        }","      } else {","        startRule = #{string(node.startRule)};","      }","      ",'      #{posInit("pos")};',"      var reportFailures = 0;",'      #{posInit("rightmostFailuresPos")};',"      var rightmostFailuresExpected = [];","      #if options.cache","        var cache = {};","      #end","      ","      function padLeft(input, padding, length) {","        var result = input;","        ","        var padLength = length - input.length;",
"        for (var i = 0; i < padLength; i++) {","          result = padding + result;","        }","        ","        return result;","      }","      ","      function escape(ch) {","        var charCode = ch.charCodeAt(0);","        var escapeChar;","        var length;","        ","        if (charCode <= 0xFF) {","          escapeChar = 'x';","          length = 2;","        } else {","          escapeChar = 'u';","          length = 4;","        }","        ","        return '\\\\' + escapeChar + padLeft(charCode.toString(16).toUpperCase(), '0', length);",
"      }","      ","      #if options.trackLineAndColumn","        function clone(object) {","          var result = {};","          for (var key in object) {","            result[key] = object[key];","          }","          return result;","        }","        ","        function advance(pos, n) {","          var endOffset = pos.offset + n;","          ","          for (var offset = pos.offset; offset < endOffset; offset++) {","            var ch = input.charAt(offset);",'            if (ch === "\\n") {',
"              if (!pos.seenCR) { pos.line++; }","              pos.column = 1;","              pos.seenCR = false;",'            } else if (ch === "\\r" || ch === "\\u2028" || ch === "\\u2029") {',"              pos.line++;","              pos.column = 1;","              pos.seenCR = true;","            } else {","              pos.column++;","              pos.seenCR = false;","            }","          }","          ","          pos.offset += n;","        }","        ","      #end","      function matchFailed(failure) {",
'        if (#{posOffset("pos")} < #{posOffset("rightmostFailuresPos")}) {',"          return;","        }","        ",'        if (#{posOffset("pos")} > #{posOffset("rightmostFailuresPos")}) {','          rightmostFailuresPos = #{posClone("pos")};',"          rightmostFailuresExpected = [];","        }","        ","        rightmostFailuresExpected.push(failure);","      }","      ","      #for rule in node.rules","        #block emit(rule)","        ","      #end","      ","      function cleanupExpected(expected) {",
"        expected.sort();","        ","        var lastExpected = null;","        var cleanExpected = [];","        for (var i = 0; i < expected.length; i++) {","          if (expected[i] !== lastExpected) {","            cleanExpected.push(expected[i]);","            lastExpected = expected[i];","          }","        }","        return cleanExpected;","      }","      ","      #if !options.trackLineAndColumn","        function computeErrorPosition() {","          /*","           * The first idea was to use |String.split| to break the input up to the",
"           * error position along newlines and derive the line and column from","           * there. However IE's |split| implementation is so broken that it was","           * enough to prevent it.","           */","          ","          var line = 1;","          var column = 1;","          var seenCR = false;","          ","          for (var i = 0; i < Math.max(pos, rightmostFailuresPos); i++) {","            var ch = input.charAt(i);",'            if (ch === "\\n") {',"              if (!seenCR) { line++; }",
"              column = 1;","              seenCR = false;",'            } else if (ch === "\\r" || ch === "\\u2028" || ch === "\\u2029") {',"              line++;","              column = 1;","              seenCR = true;","            } else {","              column++;","              seenCR = false;","            }","          }","          ","          return { line: line, column: column };","        }","      #end","      ","      #if node.initializer","        #block emit(node.initializer)",
"      #end","      ","      var result = parseFunctions[startRule]();","      ","      /*","       * The parser is now in one of the following three states:","       *","       * 1. The parser successfully parsed the whole input.","       *","       *    - |result !== null|",'       *    - |#{posOffset("pos")} === input.length|',"       *    - |rightmostFailuresExpected| may or may not contain something","       *","       * 2. The parser successfully parsed only a part of the input.","       *",
"       *    - |result !== null|",'       *    - |#{posOffset("pos")} < input.length|',"       *    - |rightmostFailuresExpected| may or may not contain something","       *","       * 3. The parser did not successfully parse any part of the input.","       *","       *   - |result === null|",'       *   - |#{posOffset("pos")} === 0|',"       *   - |rightmostFailuresExpected| contains at least one failure","       *","       * All code following this comment (including called functions) must","       * handle these states.",
"       */",'      if (result === null || #{posOffset("pos")} !== input.length) {','        var offset = Math.max(#{posOffset("pos")}, #{posOffset("rightmostFailuresPos")});',"        var found = offset < input.length ? input.charAt(offset) : null;","        #if options.trackLineAndColumn",'          var errorPosition = #{posOffset("pos")} > #{posOffset("rightmostFailuresPos")} ? pos : rightmostFailuresPos;',"        #else","          var errorPosition = computeErrorPosition();","        #end","        ",
"        throw new this.SyntaxError(","          cleanupExpected(rightmostFailuresExpected),","          found,","          offset,","          errorPosition.line,","          errorPosition.column","        );","      }","      ","      return result;","    },","    ","    /* Returns the parser source code. */","    toSource: function() { return this._source; }","  };","  ","  /* Thrown when a parser encounters a syntax error. */","  ","  result.SyntaxError = function(expected, found, offset, line, column) {",
"    function buildMessage(expected, found) {","      var expectedHumanized, foundHumanized;","      ","      switch (expected.length) {","        case 0:",'          expectedHumanized = "end of input";',"          break;","        case 1:","          expectedHumanized = expected[0];","          break;","        default:",'          expectedHumanized = expected.slice(0, expected.length - 1).join(", ")','            + " or "',"            + expected[expected.length - 1];","      }","      ",'      foundHumanized = found ? quote(found) : "end of input";',
"      ",'      return "Expected " + expectedHumanized + " but " + foundHumanized + " found.";',"    }","    ",'    this.name = "SyntaxError";',"    this.expected = expected;","    this.found = found;","    this.message = buildMessage(expected, found);","    this.offset = offset;","    this.line = line;","    this.column = column;","  };","  ","  result.SyntaxError.prototype = Error.prototype;","  ","  return result;","})()"],rule:["function parse_#{node.name}() {","  #if options.cache",'    var cacheKey = "#{node.name}@" + #{posOffset("pos")};',
"    var cachedResult = cache[cacheKey];","    if (cachedResult) {",'      pos = #{posClone("cachedResult.nextPos")};',"      return cachedResult.result;","    }","    ","  #end","  #if node.resultVars.length > 0",'    var #{node.resultVars.join(", ")};',"  #end","  #if node.posVars.length > 0",'    var #{node.posVars.join(", ")};',"  #end","  ","  #if node.displayName !== null","    reportFailures++;","  #end","  #block emit(node.expression)","  #if node.displayName !== null","    reportFailures--;",
"    if (reportFailures === 0 && #{node.resultVar} === null) {","      matchFailed(#{string(node.displayName)});","    }","  #end","  #if options.cache","    ","    cache[cacheKey] = {",'      nextPos: #{posClone("pos")},',"      result:  #{node.resultVar}","    };","  #end","  return #{node.resultVar};","}"],choice:["#block emit(alternative)","#block nextAlternativesCode"],"choice.next":["if (#{node.resultVar} === null) {","  #block code","}"],sequence:["#{posSave(node)};","#block code"],"sequence.iteration":"#block emit(element),if (#{element.resultVar} !== null) {,  #block code,} else {,  #{node.resultVar} = null;,  #{posRestore(node)};,}".split(","),
"sequence.inner":['#{node.resultVar} = [#{pluck(node.elements, "resultVar").join(", ")}];'],simple_and:'#{posSave(node)};,reportFailures++;,#block emit(node.expression),reportFailures--;,if (#{node.resultVar} !== null) {,  #{node.resultVar} = "";,  #{posRestore(node)};,} else {,  #{node.resultVar} = null;,}'.split(","),simple_not:'#{posSave(node)};,reportFailures++;,#block emit(node.expression),reportFailures--;,if (#{node.resultVar} === null) {,  #{node.resultVar} = "";,} else {,  #{node.resultVar} = null;,  #{posRestore(node)};,}'.split(","),
semantic_and:['#{node.resultVar} = (function(#{(options.trackLineAndColumn ? ["offset", "line", "column"] : ["offset"]).concat(keys(node.params)).join(", ")}) {#{node.code}})(#{(options.trackLineAndColumn ? ["pos.offset", "pos.line", "pos.column"] : ["pos"]).concat(values(node.params)).join(", ")}) ? "" : null;'],semantic_not:['#{node.resultVar} = (function(#{(options.trackLineAndColumn ? ["offset", "line", "column"] : ["offset"]).concat(keys(node.params)).join(", ")}) {#{node.code}})(#{(options.trackLineAndColumn ? ["pos.offset", "pos.line", "pos.column"] : ["pos"]).concat(values(node.params)).join(", ")}) ? null : "";'],
optional:["#block emit(node.expression)",'#{node.resultVar} = #{node.resultVar} !== null ? #{node.resultVar} : "";'],zero_or_more:"#{node.resultVar} = [];,#block emit(node.expression),while (#{node.expression.resultVar} !== null) {,  #{node.resultVar}.push(#{node.expression.resultVar});,  #block emit(node.expression),}".split(","),one_or_more:"#block emit(node.expression),if (#{node.expression.resultVar} !== null) {,  #{node.resultVar} = [];,  while (#{node.expression.resultVar} !== null) {,    #{node.resultVar}.push(#{node.expression.resultVar});,    #block emit(node.expression),  },} else {,  #{node.resultVar} = null;,}".split(","),
action:["#{posSave(node)};","#block emit(node.expression)","if (#{node.resultVar} !== null) {",'  #{node.resultVar} = (function(#{(options.trackLineAndColumn ? ["offset", "line", "column"] : ["offset"]).concat(keys(node.params)).join(", ")}) {#{node.code}})(#{(options.trackLineAndColumn ? [node.posVar + ".offset", node.posVar + ".line", node.posVar + ".column"] : [node.posVar]).concat(values(node.params)).join(", ")});',"}","if (#{node.resultVar} === null) {","  #{posRestore(node)};","}"],rule_ref:["#{node.resultVar} = parse_#{node.name}();"],
literal:["#if node.value.length === 0",'  #{node.resultVar} = "";',"#else","  #if !node.ignoreCase","    #if node.value.length === 1",'      if (input.charCodeAt(#{posOffset("pos")}) === #{node.value.charCodeAt(0)}) {',"    #else",'      if (input.substr(#{posOffset("pos")}, #{node.value.length}) === #{string(node.value)}) {',"    #end","  #else",'    if (input.substr(#{posOffset("pos")}, #{node.value.length}).toLowerCase() === #{string(node.value.toLowerCase())}) {',"  #end","    #if !node.ignoreCase",
"      #{node.resultVar} = #{string(node.value)};","    #else",'      #{node.resultVar} = input.substr(#{posOffset("pos")}, #{node.value.length});',"    #end","    #{posAdvance(node.value.length)};","  } else {","    #{node.resultVar} = null;","    if (reportFailures === 0) {","      matchFailed(#{string(string(node.value))});","    }","  }","#end"],any:'if (input.length > #{posOffset("pos")}) {,  #{node.resultVar} = input.charAt(#{posOffset("pos")});,  #{posAdvance(1)};,} else {,  #{node.resultVar} = null;,  if (reportFailures === 0) {,    matchFailed("any character");,  },}'.split(","),
"class":'if (#{regexp}.test(input.charAt(#{posOffset("pos")}))) {,  #{node.resultVar} = input.charAt(#{posOffset("pos")});,  #{posAdvance(1)};,} else {,  #{node.resultVar} = null;,  if (reportFailures === 0) {,    matchFailed(#{string(node.rawText)});,  },}'.split(",")};for(D in na)E[D]=q.template(na[D].join("\n"));C=E;var B=n({grammar:p("grammar"),initializer:function(a){return a.code},rule:p("rule"),choice:function(a){for(var b,c=a.alternatives.length-1;0<=c;c--)b=c!==a.alternatives.length-1?i("choice.next",
{node:a,code:b}):"",b=i("choice",{alternative:a.alternatives[c],nextAlternativesCode:b});return b},sequence:function(a){for(var b=i("sequence.inner",{node:a}),c=a.elements.length-1;0<=c;c--)b=i("sequence.iteration",{node:a,element:a.elements[c],code:b});return i("sequence",{node:a,code:b})},labeled:function(a){return B(a.expression)},simple_and:p("simple_and"),simple_not:p("simple_not"),semantic_and:p("semantic_and"),semantic_not:p("semantic_not"),optional:p("optional"),zero_or_more:p("zero_or_more"),
one_or_more:p("one_or_more"),action:p("action"),rule_ref:p("rule_ref"),literal:p("literal"),any:p("any"),"class":function(a){var b;b=0<a.parts.length?"/^["+(a.inverted?"^":"")+c(a.parts,function(a){return a instanceof Array?k(a[0])+"-"+k(a[1]):k(a)}).join("")+"]/"+(a.ignoreCase?"i":""):a.inverted?"/^[\\S\\s]/":"/^(?!)/";return i("class",{node:a,regexp:b})}});return B(b)};return p}();"undefined"!==typeof module&&(module.exports=PEG);
var Base64={getBase64ImageFromInput:function(a,b){var d=new FileReader;d.onloadend=function(a){b&&b(a.target.result)};d.readAsDataURL(a)},formatImageSrcString:function(a){return a.match(/(base64)/)?a:"data:image/jpeg;base64,"+a}},DateTimePicker=function(){var a={},b=function(a){return 1===String(a).length?"0"+a:a};a.createDatePicker=function(a){var a=a||new Date,c=document.createElement("input");c.type="date";c.value=a.getFullYear()+"-"+b(a.getMonth()+1)+"-"+b(a.getDate());("text"===c.type||navigator.userAgent.match(/(Android)/))&&
$(c).scroller({dateFormat:"yyyy-mm-dd",dateOrder:"yymmdd"});c.isValid=function(){return c.value.match("[0-9]{4}-(0[1-9]|1[012])-(0[1-9]|1[0-9]|2[0-9]|3[01])")};return c};a.createTimePicker=function(a){var a=a||new Date,c=document.createElement("input");c.type="time";c.value=b(a.getHours())+":"+b(a.getMinutes());("text"===c.type||navigator.userAgent.match(/(Android)/))&&$(c).scroller({preset:"time",ampm:!1,timeFormat:"HH:ii"});c.isValid=function(){return c.value.match("^(([0-9])|([0-1][0-9])|([2][0-3])):(([0-9])|([0-5][0-9]))$")};
c.getInput=function(){return c.value};c.getHours=function(){return parseInt(c.getInput().split(":")[0],10)};c.getMinutes=function(){return parseInt(c.getInput().split(":")[1],10)};return c};return a};DateTimePicker.createDateTimeForm=function(a,b,d){a=mwf.decorator.Form(a);a.addLabel("Select Date");a.addItem(b);a.addLabel("Select Time");a.addItem(d);return a};DateTimePicker.getPaddedTime=function(a){return a.getHours()+":"+(10>a.getMinutes()?"0":"")+a.getMinutes()};
var DeviceDetection=function(){var a={},b=navigator.userAgent,d=document.URL;a.isOnDevice=function(){return b.match(/(iPhone|iPod|iPad|Android|BlackBerry)/)};a.isDeviceiOS=function(){return b.match(/(iPhone|iPod|iPad)/)};a.isDeviceAndroid=function(){return b.match(/(Android)/)};a.isNativeApplication=function(){return-1===d.indexOf("http://")&&-1===d.indexOf("https://")};a.setUserAgent=function(a){b=a};a.setDocumentURL=function(a){d=a};return a}(),localStorage=window.localStorage,LocalMap=function(a){var b=
{};localStorage||(localStorage={});localStorage[a]||(localStorage[a]="{}");var d=function(b){localStorage[a]=window.JSON.stringify(b)};b.getMap=function(){return window.JSON.parse(localStorage[a])};b.set=function(a,g){var f=b.getMap();f[a]=g;d(f)};b.get=function(a){var d=b.getMap();return"undefined"!==typeof d[a]?d[a]:null};b.importMap=function(a){var g=b.getMap(),f;for(f in a)a.hasOwnProperty(f)&&(g[f]=a[f]);d(g)};b.length=function(){var a=b.getMap(),d=0,f;for(f in a)a.hasOwnProperty(f)&&(d+=1);
return d};b.erase=function(){window.localStorage[a]=window.JSON.stringify({})};b.isSet=function(a){return null!==b.get(a)};b.release=function(a){var g=b.getMap();g[a]&&delete g[a];d(g)};b.deleteNamespace=function(){localStorage.hasOwnProperty(a)&&delete localStorage[a]};return b};LocalMap.destroy=function(){for(var a in localStorage)localStorage.hasOwnProperty(a)&&delete localStorage[a]};LocalMap.exists=function(a){return localStorage[a]?!0:!1};
var LocalNotificationAdapter=function(){var a={},b=function(){return"undefined"!==typeof plugins&&"undefined"!==typeof plugins.localNotification};a.add=function(a){b()&&(DeviceDetection.isDeviceAndroid()?plugins.localNotification.add({date:a.date,message:"You have a pending survey.",ticker:"You have a pending survey.",repeatDaily:a.repeatDaily,id:a.id}):DeviceDetection.isDeviceiOS()&&plugins.localNotification.add({date:a.date,message:a.message,background:"goToPendingSurveys",badge:1,id:a.id,sound:"horn.caf"}))};
a.cancel=function(a){b()&&(console.log("LocalNotificationAdapter: cancel("+a+")"),plugins.localNotification.cancel(a))};a.cancelAll=function(){b()&&(console.log("LocalNotificationAdapter: cancelAll()"),plugins.localNotification.cancelAll())};return a}();function goToPendingSurveys(){window.location="pending-surveys.html"}var Logger=function(){}();Logger.log=function(){Console.log(arguments)};
var Spinner=function(){var a={},b=$("<img>").attr("src","img/spinner.gif?"+(new Date).getTime()).addClass("spinner-img").attr("id","spinner-img"),d=!1,c=$("<div>");c.attr("class","spinner-container");c.attr("id","spinner-container");var g=$("<div>");g.attr("class","spinner");g.attr("id","spinner");var f=$("<a>");f.attr("href",null);f.attr("class","cancel_link");f.text("Cancel Loading...");f.hide();g.append(b);g.append(f);c.append(g);a.show=function(a){if(d)console.log("Spinner: show() canceled because spinner is already active.");
else{d=!0;console.log("Spinner: Showing spinner.");$("#spinner-img").attr("src","").attr("src","img/spinner.gif?"+(new Date).getTime());$("#spinner-img").show();$(document.body).append(n);j=$(document).width();k=$(document).height();$("#spinner-background").width(j+"px");$("#spinner-background").height(k+"px");h=setInterval(function(){if(window.orientation&&d&&(null===i||i!==window.orientation)){var a,b,c;if(0===window.orientation||180===window.orientation)c=140,a=Math.min(j,k),b=Math.max(j,k);else if(90===
window.orientation||-90===window.orientation)c=80,a=Math.max(j,k)+50,b=Math.min(j,k);$("#spinner-background").width("0px").width(a+"px");$("#spinner-background").height("0px").height(b+"px");i=window.orientation;b=$(window).scrollTop()+c+"px";a=$(window).scrollLeft()+(a-$("#spinner").outerWidth())/2+"px";$("#spinner").css("top",b);$("#spinner").css("left",a)}},15);a&&(f.show(),f.onClick=function(){a()});$(document.body).append(c);var b=140+$(window).scrollTop()+"px",t=$(window).scrollLeft()+($(window).width()-
g.outerWidth())/2+"px";g.css("top",b);g.css("left",t)}};var h=null,i=null,j,k,n=$(document.createElement("div"));n.attr("class","spinner-background");n.attr("id","spinner-background");a.hide=function(a){if(d)d=!1;else if(console.log("Spinner: hide() canceled because spinner is already inactive."),a){a();return}console.log("Spinner: Hiding spinner.");var b=function(){$("#spinner-background,#spinner-container").remove();a&&a()};f.hide();!1===$("#spinner-container").is(":visible")?($("#spinner-background").hide(),
$("#spinner-container").hide(),b()):($("#spinner-background").fadeOut(25),$("#spinner-container").fadeOut(25,b()));h&&clearInterval(h)};return a}(),TouchEnabledItemModel=function(){var a={bindClickEvents:function(a,d,c,g){"function"===typeof c&&$(a).mouseover(function(){$(d).addClass(g)}).mouseout(function(){$(d).removeClass(g)}).click(c)},bindTouchEvents:function(b,d,c,g){a.bindClickEvents(b,function(a){a.preventDefault();return!1});var f;$(b).bind("touchstart",function(){f=0;$(d).addClass(g)});
$(b).bind("touchmove",function(a){if($(d).is("."+g)){f+=1;var b=a.srcElement,c=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0],k=$(b).offset(),a=c.pageX-k.left,c=c.pageY-k.top;(15<f||!(a<$(b).width()&&0<a)||!(c<$(b).height()&&0<c))&&$(d).removeClass(g)}});$(b).bind("touchend",function(a){a.preventDefault();15>=f&&$(d).is("."+g)&&($(d).removeClass(g),"function"===typeof c&&c(a))})},bindTouchEvent:function(b,d,c,g){d=d||b;g=g||"pressed";DeviceDetection.isOnDevice()?a.bindTouchEvents(b,
d,c,g):a.bindClickEvents(b,d,c,g)}};return a}(),UUIDGen={generate:function(){var a=[],b;for(b=0;36>b;b+=1)a[b]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);a[14]="4";a[19]="0123456789abcdef".substr(a[19]&3|8,1);a[8]=a[13]=a[18]=a[23]="-";return a.join("")}},jstz=function(){var a=function(a){a=-a.getTimezoneOffset();return null!==a?a:0},b=function(){return a(new Date(2010,0,1,0,0,0,0))},d=function(){return a(new Date(2010,5,1,0,0,0,0))};return{determine_timezone:function(){var a=b(),g=
d(),f=b()-d();return new jstz.TimeZone(jstz.olson.timezones[0>f?a+",1":0<f?g+",1,s":a+",0"])},date_is_dst:function(c){var g=5<c.getMonth()?d():b(),c=a(c);return 0!==g-c}}}();
jstz.TimeZone=function(){var a=null,b=null,d=null,c=function(c){d=c[0];a=c[1];b=c[2];if("undefined"!==typeof jstz.olson.ambiguity_list[a])a:for(var c=jstz.olson.ambiguity_list[a],f=c.length,h=0,i=c[0];h<f;h+=1)if(i=c[h],jstz.date_is_dst(jstz.olson.dst_start_dates[i])){a=i;break a}};c.prototype={constructor:jstz.TimeZone,name:function(){return a},dst:function(){return b},offset:function(){return d}};return c}();jstz.olson={};
jstz.olson.timezones=function(){return{"-720,0":["-12:00","Etc/GMT+12",!1],"-660,0":["-11:00","Pacific/Pago_Pago",!1],"-600,1":["-11:00","America/Adak",!0],"-660,1,s":["-11:00","Pacific/Apia",!0],"-600,0":["-10:00","Pacific/Honolulu",!1],"-570,0":["-10:30","Pacific/Marquesas",!1],"-540,0":["-09:00","Pacific/Gambier",!1],"-540,1":["-09:00","America/Anchorage",!0],"-480,1":["-08:00","America/Los_Angeles",!0],"-480,0":["-08:00","Pacific/Pitcairn",!1],"-420,0":["-07:00","America/Phoenix",!1],"-420,1":["-07:00",
"America/Denver",!0],"-360,0":["-06:00","America/Guatemala",!1],"-360,1":["-06:00","America/Chicago",!0],"-360,1,s":["-06:00","Pacific/Easter",!0],"-300,0":["-05:00","America/Bogota",!1],"-300,1":["-05:00","America/New_York",!0],"-270,0":["-04:30","America/Caracas",!1],"-240,1":["-04:00","America/Halifax",!0],"-240,0":["-04:00","America/Santo_Domingo",!1],"-240,1,s":["-04:00","America/Asuncion",!0],"-210,1":["-03:30","America/St_Johns",!0],"-180,1":["-03:00","America/Godthab",!0],"-180,0":["-03:00",
"America/Argentina/Buenos_Aires",!1],"-180,1,s":["-03:00","America/Montevideo",!0],"-120,0":["-02:00","America/Noronha",!1],"-120,1":["-02:00","Etc/GMT+2",!0],"-60,1":["-01:00","Atlantic/Azores",!0],"-60,0":["-01:00","Atlantic/Cape_Verde",!1],"0,0":["00:00","Etc/UTC",!1],"0,1":["00:00","Europe/London",!0],"60,1":["+01:00","Europe/Berlin",!0],"60,0":["+01:00","Africa/Lagos",!1],"60,1,s":["+01:00","Africa/Windhoek",!0],"120,1":["+02:00","Asia/Beirut",!0],"120,0":["+02:00","Africa/Johannesburg",!1],
"180,1":["+03:00","Europe/Moscow",!0],"180,0":["+03:00","Asia/Baghdad",!1],"210,1":["+03:30","Asia/Tehran",!0],"240,0":["+04:00","Asia/Dubai",!1],"240,1":["+04:00","Asia/Yerevan",!0],"270,0":["+04:30","Asia/Kabul",!1],"300,1":["+05:00","Asia/Yekaterinburg",!0],"300,0":["+05:00","Asia/Karachi",!1],"330,0":["+05:30","Asia/Kolkata",!1],"345,0":["+05:45","Asia/Kathmandu",!1],"360,0":["+06:00","Asia/Dhaka",!1],"360,1":["+06:00","Asia/Omsk",!0],"390,0":["+06:30","Asia/Rangoon",!1],"420,1":["+07:00","Asia/Krasnoyarsk",
!0],"420,0":["+07:00","Asia/Jakarta",!1],"480,0":["+08:00","Asia/Shanghai",!1],"480,1":["+08:00","Asia/Irkutsk",!0],"525,0":["+08:45","Australia/Eucla",!0],"525,1,s":["+08:45","Australia/Eucla",!0],"540,1":["+09:00","Asia/Yakutsk",!0],"540,0":["+09:00","Asia/Tokyo",!1],"570,0":["+09:30","Australia/Darwin",!1],"570,1,s":["+09:30","Australia/Adelaide",!0],"600,0":["+10:00","Australia/Brisbane",!1],"600,1":["+10:00","Asia/Vladivostok",!0],"600,1,s":["+10:00","Australia/Sydney",!0],"630,1,s":["+10:30",
"Australia/Lord_Howe",!0],"660,1":["+11:00","Asia/Kamchatka",!0],"660,0":["+11:00","Pacific/Noumea",!1],"690,0":["+11:30","Pacific/Norfolk",!1],"720,1,s":["+12:00","Pacific/Auckland",!0],"720,0":["+12:00","Pacific/Tarawa",!1],"765,1,s":["+12:45","Pacific/Chatham",!0],"780,0":["+13:00","Pacific/Tongatapu",!1],"840,0":["+14:00","Pacific/Kiritimati",!1]}}();
jstz.olson.dst_start_dates=function(){return{"America/Denver":new Date(2011,2,13,3,0,0,0),"America/Mazatlan":new Date(2011,3,3,3,0,0,0),"America/Chicago":new Date(2011,2,13,3,0,0,0),"America/Mexico_City":new Date(2011,3,3,3,0,0,0),"Atlantic/Stanley":new Date(2011,8,4,7,0,0,0),"America/Asuncion":new Date(2011,9,2,3,0,0,0),"America/Santiago":new Date(2011,9,9,3,0,0,0),"America/Campo_Grande":new Date(2011,9,16,5,0,0,0),"America/Montevideo":new Date(2011,9,2,3,0,0,0),"America/Sao_Paulo":new Date(2011,
9,16,5,0,0,0),"America/Los_Angeles":new Date(2011,2,13,8,0,0,0),"America/Santa_Isabel":new Date(2011,3,5,8,0,0,0),"America/Havana":new Date(2011,2,13,2,0,0,0),"America/New_York":new Date(2011,2,13,7,0,0,0),"Asia/Gaza":new Date(2011,2,26,23,0,0,0),"Asia/Beirut":new Date(2011,2,27,1,0,0,0),"Europe/Minsk":new Date(2011,2,27,2,0,0,0),"Europe/Helsinki":new Date(2011,2,27,4,0,0,0),"Europe/Istanbul":new Date(2011,2,28,5,0,0,0),"Asia/Damascus":new Date(2011,3,1,2,0,0,0),"Asia/Jerusalem":new Date(2011,3,1,
6,0,0,0),"Africa/Cairo":new Date(2010,3,30,4,0,0,0),"Asia/Yerevan":new Date(2011,2,27,4,0,0,0),"Asia/Baku":new Date(2011,2,27,8,0,0,0),"Pacific/Auckland":new Date(2011,8,26,7,0,0,0),"Pacific/Fiji":new Date(2010,11,29,23,0,0,0),"America/Halifax":new Date(2011,2,13,6,0,0,0),"America/Goose_Bay":new Date(2011,2,13,2,1,0,0),"America/Miquelon":new Date(2011,2,13,5,0,0,0),"America/Godthab":new Date(2011,2,27,1,0,0,0)}}();
jstz.olson.ambiguity_list={"America/Denver":["America/Denver","America/Mazatlan"],"America/Chicago":["America/Chicago","America/Mexico_City"],"America/Asuncion":["Atlantic/Stanley","America/Asuncion","America/Santiago","America/Campo_Grande"],"America/Montevideo":["America/Montevideo","America/Sao_Paulo"],"Asia/Beirut":"Asia/Gaza Asia/Beirut Europe/Minsk Europe/Helsinki Europe/Istanbul Asia/Damascus Asia/Jerusalem Africa/Cairo".split(" "),"Asia/Yerevan":["Asia/Yerevan","Asia/Baku"],"Pacific/Auckland":["Pacific/Auckland",
"Pacific/Fiji"],"America/Los_Angeles":["America/Los_Angeles","America/Santa_Isabel"],"America/New_York":["America/Havana","America/New_York"],"America/Halifax":["America/Goose_Bay","America/Halifax"],"America/Godthab":["America/Miquelon","America/Godthab"]};
var CampaignView=function(a){var b={deleteCampaignHandler:function(){},openSurveyViewHandler:function(){},render:function(){var d=document.createElement("div");if(a.isRunning())d.appendChild(CampaignView.renderSurveyList(a,mwf.decorator.Menu("Available Surveys"),b.openSurveyViewHandler));else{var c=mwf.decorator.Content("Inactive Campaign");c.addTextBlock("This campaign is currently inactive and does not open for participation.");d.appendChil(c)}d.appendChild(mwf.decorator.SingleClickButton("Delete Campaign",
b.deleteCampaignHandler));return d}};return b};CampaignView.renderSurveyList=function(a,b,d){var c=function(b){return function(){d(a.getURN(),b)}},g=a.getSurveys(),f,h;for(h=0;h<g.length;h+=1)f=b.addMenuLinkItem(g[h].title,null,g[h].description),TouchEnabledItemModel.bindTouchEvent(f,f,c(g[h].id),"menu-highlight");return b};
var CampaignsView=function(a){var b={},d=function(a){return function(){b.installNewCampaignHandler(a)}},c=function(a){return function(){b.openMyCampaignHandler(a)}};b.installNewCampaignHandler=function(){};b.openMyCampaignHandler=function(){};b.refreshCampaignsListHandler=function(){};b.renderMyCampaigns=function(){var b=mwf.decorator.Menu("My Campaigns"),d=a.getInstalledCampaigns(),h,i;for(i in d)h=d[i],h.isRunning()&&(h=b.addMenuLinkItem(h.getName()),TouchEnabledItemModel.bindTouchEvent(h,h,c(i),
"menu-highlight"));return b};b.renderAvailableCampaigns=function(){var c=document.createElement("div"),f=mwf.decorator.Menu("Available Campaigns"),h=a.getAvailableCampaigns(),i,j;for(j in h)i=h[j],i.isRunning()&&(i=f.addMenuLinkItem(i.getName()),TouchEnabledItemModel.bindTouchEvent(i,i,d(j),"menu-highlight"));$(f).find("a").css("background","url('img/plus.png') no-repeat 95% center");c.appendChild(f);c.appendChild(mwf.decorator.SingleClickButton("Refresh Campaigns",b.refreshCampaignsListHandler));
return c};return b},ChangeServerView=function(a){var b={saveButtonHandler:function(){},render:function(){var d=mwf.decorator.Form("Available Servers"),c=document.createElement("select"),g,f;for(f=0;f<a.length;f+=1)g=document.createElement("option"),g.value=a[f],g.innerHTML=a[f],c.appendChild(g),a[f]===ConfigManager.getServerEndpoint()&&(g.selected="selected");d.addLabel("Server Endpoint");d.addItem(c);b.getSelectedServer=function(){return c.options[c.selectedIndex].value};d.addInputButton("Save Selection",
b.saveButtonHandler);return d}};return b},HelpMenuView=function(a){return{render:function(){var b=mwf.decorator.Menu("Help Menu"),d,c,g=function(a){return function(){PageNavigation.openHelpSectionView(a)}};for(c=0;c<a.length;c+=1)d=b.addMenuLinkItem(a[c].title,null,null),TouchEnabledItemModel.bindTouchEvent(d,d,g(c),"menu-highlight");return b}}},HelpSectionView=function(a){return{render:function(){var b,d,c;b=document.createElement("img");b.className="help-section-image";b.src=a.img;d=document.createElement("p");
d.className="help-section-text";d.innerHTML=a.text||"";c=document.createElement("div");c.className="help-section-container";c.appendChild(b);c.appendChild(d);b=mwf.decorator.Content(a.title);b.addItem(c);return b}}},ProfileView=function(){var a={changePasswordHandler:function(){},clearCustomizedChoicesHandler:function(){},enableGpsHandler:function(){},disableGpsHandler:function(){},logoutAndClearDataHandler:function(){},render:function(){var b=mwf.decorator.Menu(auth.getUsername()),d=b.addMenuLinkItem("Change Password",
null,"Easily change your password.");TouchEnabledItemModel.bindTouchEvent(d,d,a.changePasswordHandler,"menu-highlight");d=b.addMenuLinkItem("Clear Customized Choices",null,"Erase any saved custom choices.");TouchEnabledItemModel.bindTouchEvent(d,d,a.clearCustomizedChoicesHandler,"menu-highlight");ConfigManager.getGpsEnabled()?(d=b.addMenuLinkItem("Disable GPS Acquisition",null,"By disabling GPS acquisition, uploaded surveys will not include GPS location."),TouchEnabledItemModel.bindTouchEvent(d,d,
a.disableGpsHandler,"menu-highlight")):(d=b.addMenuLinkItem("Enable GPS Acquisition",null,"By enabling GPS acquisition, all uploaded surveys will be geotaged with your current location."),TouchEnabledItemModel.bindTouchEvent(d,d,a.enableGpsHandler,"menu-highlight"));d=b.addMenuLinkItem("Logout and Clear Data",null,"When you logout, all the data stored on the phone will be completely erased.");TouchEnabledItemModel.bindTouchEvent(d,d,a.logoutAndClearDataHandler,"menu-highlight");return b}};return a},
PromptView=function(){var a={single_choice:PromptView.renderSingleChoicePrompt,single_choice_custom:PromptView.renderSingleChoiceCustomPrompt,multi_choice:PromptView.renderMultiChoicePrompt,multi_choice_custom:PromptView.renderMultiChoiceCustomPrompt,text:PromptView.renderTextPrompt,timestamp:PromptView.renderTimestampPrompt,hours_before_now:PromptView.renderHoursBeforeNow,unsupported:PromptView.renderUnsupportedPrompt};return function(b){var d={renderSupported:function(){return"function"===typeof a[b.getType()]},
render:function(){return d.renderSupported()?a[b.getType()](b):a.unsupported(b)}};return d}}();
PromptView.createChoiceMenu=function(a,b,d){var c=a.getProperties(),g=mwf.decorator.Menu(a.getText()),f;for(f=0;f<c.length;f+=1)b?g.addMenuRadioItem(a.getID(),c[f].key,c[f].label):g.addMenuCheckboxItem(a.getID(),c[f].key,c[f].label);a.getResponse=function(){var a=d?"label":"value";if(b)return g.getSelectedOptions()[0][a];var c=[],f=g.getSelectedOptions(),k;for(k=0;k<f.length;k+=1)c.push(f[k][a]);return c};return g};
PromptView.createCustomChoiceMenu=function(a,b,d){b.addMenuIconItem("Add custom option",null,"img/plus.png");b.getLastMenuItem().onclick=function(){c.style.display="block"};var c=mwf.decorator.Form("Custom Choice");c.style.display="none";c.addTextBox("new-choice","new-choice");var g=function(){c.style.display="none";document.getElementById("new-choice").value=""},f=function(){var c=document.getElementById("new-choice").value;if(0===c.length)return MessageDialogController.showMessage("Please specify an option to add."),
!1;c=a.addProperty(c);if(!c)return MessageDialogController.showMessage("Option with that label already exists."),!1;var f=b.getLastMenuItem();b.removeMenuItem(f);d?b.addMenuRadioItem(a.getID(),c.key,c.label):b.addMenuCheckboxItem(a.getID(),c.key,c.label);g();b.addMenuItem(f,!0);return!0};c.addInputButton("Create New Choice",f);c.addInputButton("Cancel",g);$(c).submit(function(a){f();a.preventDefault();return!1});var h=document.createElement("div");h.appendChild(b);h.appendChild(c);return h};
PromptView.renderHoursBeforeNow=function(a){return PromptView.renderNumberPrompt(a)};PromptView.renderMultiChoicePrompt=function(a,b){var d=PromptView.createChoiceMenu(a,!1,b);a.isValid=function(){return 0===d.getSelectedOptions().length?(a.setErrorMessage("Please select an option."),!1):!0};return d};
PromptView.renderNumberPrompt=function(){var a=function(a){return null!==a.getDefaultValue()?a.getDefaultValue():null!==a.getMinValue()?a.getMinValue():0},b=function(b,g){var f=document.createElement("p");f.className="number-counter";f.innerHTML=g||a(prompt);var h=b.getMaxValue(),i=b.getMinValue(),j=document.createElement("p");j.innerHTML="+";var k=document.createElement("p");k.innerHTML="-";var n=function(){var a=parseInt(f.innerHTML,10);j.className=a<h?"math-sign plus":"math-sign-disabled plus";
k.className=a>i?"math-sign minus":"math-sign-disabled minus"};n();var q=mwf.decorator.Menu(prompt.getText()),p=q.addMenuItem(j);q.addMenuItem(f);var t=q.addMenuItem(k);b.getResponse=function(){return parseInt(f.innerHTML,10)};b.isValid=function(){return!0};TouchEnabledItemModel.bindTouchEvent(p,j,function(){var a=parseInt(f.innerHTML,10);a<h&&(f.innerHTML=a+1);n()});TouchEnabledItemModel.bindTouchEvent(t,k,function(){var a=parseInt(f.innerHTML,10);a>i&&(f.innerHTML=a-1);n()});var r=document.createElement("div");
r.appendChild(mwf.decorator.SingleClickButton("Switch to Number Input",function(){r.innerHTML="";r.appendChild(d(b.getResponse()))}));r.appendChild(q);return r},d=function(c,d){var f=c.getMinValue(),h=c.getMaxValue(),i="Please enter a number between "+f+" and "+h+", inclusive.",j=function(a){if(""===a)return!1;a=parseInt(a,10);return f<=a&&a<=h},k=document.createElement("input");k.value=d||a(c);k.onkeypress=function(a){var b=a||window.event,c=b.keyCode||b.which,c=String.fromCharCode(c);if(-1===String((a.target||
a.srcElement).value+c).search(/^(\+|-)?$/)&&-1===String(c).search(/^(\+|-)?\d+\s*$/))b.returnValue=!1,b.preventDefault&&b.preventDefault()};var n=mwf.decorator.Form(prompt.getText());n.addLabel(i);n.addItem(k);c.isValid=function(){return!j(k.value)?(c.setErrorMessage(i),!1):!0};c.getResponse=function(){return parseInt(k.value,10)};var q=document.createElement("div");q.appendChild(mwf.decorator.SingleClickButton("Switch to Number Picker",function(){q.innerHTML="";q.appendChild(b(c,j(k.value)?c.getResponse():
!1))}));q.appendChild(n);return q};return function(a){return 20>=a.getMaxValue()-a.getMinValue()?b(a):d(a)}}();
PromptView.renderPhotoPrompt=function(a){var b=document.createElement("div"),d=mwf.decorator.Form("Image");d.style.display="none";b.appendChild(d);var c=document.createElement("img");c.style.width="100%";d.addItem(c);var g=function(a,b){c.src=(b?"data:image/jpeg;base64,":"")+a;d.style.display="block";c.alt=SurveyResponseModel.saveImage(a)};if(navigator.camera)var f=mwf.decorator.SingleClickButton(a.getText(),function(){navigator.camera.getPicture(function(a){g(a,!0)},function(a){MessageDialogController.showMessage("Failed because: "+
a)},{quality:25,destinationType:navigator.Camera.DestinationType.DATA_URL})});else{var f=mwf.decorator.Form(a.getText()),h=document.createElement("input");h.type="file";f.addItem(h);h.onchange=function(){var a=this.files[0];a?Base64.getBase64ImageFromInput(a,function(a){g(a,!1)}):MessageDialogController.showMessage("Please select an image.")}}b.appendChild(f);a.isValid=function(){return!c.alt?(a.setErrorMessage("Please take an image to submit."),!1):!0};a.getResponse=function(){return c.alt};return b};
PromptView.renderSingleChoicePrompt=function(a,b){var d=PromptView.createChoiceMenu(a,!0,b);a.isValid=function(){return 1!==d.getSelectedOptions().length?(a.setErrorMessage("Please select a single option."),!1):!0};return d};
PromptView.renderTextPrompt=function(a){var b=a.getMaxValue(),d=a.getMinValue(),c=mwf.decorator.Form(a.getText()),g=document.createElement("textarea");c.addItem(g);a.isValid=function(){g.value=g.value.replace(/^\s+|\s+$/g,"");var c=g.value.length;return c<d?(a.setErrorMessage("Please enter text more than "+d+" characters in length."),!1):c>b?(a.setErrorMessage("Please enter text no longer than "+b+" characters."),!1):!0};a.getResponse=function(){return g.value.replace(/^\s+|\s+$/g,"")};return c};
PromptView.renderTimestampPrompt=function(a){var b=new Date,d=new DateTimePicker,c=d.createDatePicker(b),g=d.createTimePicker(b);a.isValid=function(){if(c.isValid()){if(!g.isValid())return a.setErrorMessage("Please specify time in the format: HH-MM."),!1}else return a.setErrorMessage("Please specify date in the format: YYYY-MM-DD."),!1;return!0};a.getResponse=function(){return c.value+"T"+g.value+":00"};return DateTimePicker.createDateTimeForm(prompt.getText(),c,g)};
PromptView.renderUnsupportedPrompt=function(a){var b=mwf.decorator.Menu(a.getText());b.addMenuTextItem("Unfortunatly current prompt type is not supported.");a.getResponse=function(){return SurveyResponseModel.NOT_DISPLAYED_PROMPT_VALUE};return b};
var ReminderListView=function(a,b,d){return{render:function(c){var c=c||mwf.decorator.Menu(b),g=function(a){return function(){d(a)}},f,h,i;for(f=0;f<a.length;f+=1)h=a[f].getTitle(),i=a[f].getDate(),i="Reminder set for "+DateTimePicker.getPaddedTime(i)+".",h=c.addMenuLinkItem(h,null,i),TouchEnabledItemModel.bindTouchEvent(h,h,g(a[f]),"menu-highlight");return c}}},ReminderView=function(a,b){var d={},c=function(){PageNavigation.openRemindersView()},g=function(){var b="Are you sure you would like to delete the reminder for "+
a.getTitle()+"?";MessageDialogController.showConfirm(b,function(b){b&&(a.deleteReminder(),PageNavigation.openRemindersView())},"Yes,No")};d.render=function(){var d=a.getDate();null===d&&(d=new Date,d.setTime(d.getTime()+6E5));var h=(new DateTimePicker).createTimePicker(d);h.className+=" time-picker-input";var d=function(a,b,c){var d=document.createElement("option");d.survey={title:a,surveyID:b,campaignURN:c};d.innerHTML=a;return d},i=document.createElement("select"),j=CampaignsModel.getInstalledCampaigns(),
k,n,q,p,t,r;i.className="reminder-survey-select";i.appendChild(d("Select a Survey to Continue"));for(t=0;t<j.length;t+=1)if(j[t].isRunning()){n=j[t].getSurveys();q=j[t].getURN();for(r=0;r<n.length;r+=1)k=n[r],p=d(k.title,k.id,q),a.getCampaignURN()===q&&a.getSurveyID()===k.id&&(p.selected="selected"),i.appendChild(p)}i.getInput=function(){return i.options[i.selectedIndex].survey};var v=document.createElement("select");v.className="supression-window-select";for(d=1;24>=d;d+=1)j=document.createElement("option"),
j.value=d,j.innerHTML=d+" hour"+(1!==d?"s":""),v.appendChild(j),d===a.getSupressionWindow()&&(j.selected="selected");v.getInput=function(){return v.options[v.selectedIndex].value};var x=document.createElement("select");x.className="recurrence-select";for(j=1;31>j;j+=1)d=document.createElement("option"),d.value=j,d.innerHTML=j,x.appendChild(d),j===a.getRecurrence()&&(d.selected="selected");x.getInput=function(){return x.options[x.selectedIndex].value};var m=document.createElement("input"),d=UUIDGen.generate();
m.setAttribute("type","checkbox");m.setAttribute("id",d);a.excludeWeekends()&&(m.checked="checked");j=document.createElement("label");j.innerHTML="Exclude Weekends: ";j.setAttribute("for",d);var s=document.createElement("div");s.style.textAlign="center";s.appendChild(j);s.appendChild(m);s.excludeWeekends=function(){return m.checked};d=mwf.decorator.Form("Create New Reminder");d.addLabel("Reminder Survey");d.addItem(i);d.addLabel("Select Time");d.addItem(h);d.addLabel("Suppression Window");d.addItem(v);
d.addLabel("Recurrence (number of days)");d.addItem(x);d.addLabel("Preferences");d.addItem(s);j=document.createElement("div");j.appendChild(mwf.decorator.DoubleClickButton("Cancel",c,"Save",function(){if(0===i.selectedIndex)alert("Please select a survey to add a reminder.");else{var a=i.getInput(),c=new Date;c.setHours(h.getHours());c.setMinutes(h.getMinutes());console.log("time picker getMinutes() -- "+h.getMinutes());console.log("date getMinutes() -- "+c.getMinutes());var d=v.getInput(),f=x.getInput(),
g=s.excludeWeekends();b.save(a.campaignURN,a.surveyID,a.title,c,d,f,g);PageNavigation.openRemindersView()}}));a.isSaved()&&j.appendChild(mwf.decorator.SingleClickButton("Delete Reminder",g));k=document.createElement("div");k.appendChild(d);k.appendChild(j);return k};return d},RemindersView=function(a){var b={},d=function(){PageNavigation.openNewReminderView()},c=function(a){return function(){PageNavigation.openReminderView(a.getUUID())}};b.render=function(){var b=CampaignsModel.getInstalledCampaignsCount(),
f=mwf.decorator.Menu("Available Reminders"),h=document.createElement("div"),i,j,k;if(0===b)k=f.addMenuLinkItem("No Available Surveys",null,"Please install a campaign, to create custom reminders."),TouchEnabledItemModel.bindTouchEvent(k,k,PageNavigation.openAvailableCampaignsView,"menu-highlight");else if(0<a.length)for(k=0;k<a.length;k+=1)i=a[k].getTitle(),j=a[k].getDate(),j="Reminder set for "+DateTimePicker.getPaddedTime(j)+".",i=f.addMenuLinkItem(i,null,j),TouchEnabledItemModel.bindTouchEvent(i,
i,c(a[k]),"menu-highlight");else k=f.addMenuLinkItem("No Reminder Found",null,"Click to add a new reminder."),TouchEnabledItemModel.bindTouchEvent(k,k,d,"menu-highlight");h.appendChild(f);0<b&&h.appendChild(mwf.decorator.SingleClickButton("Add Reminder",d));return h};return b},SurveyListView=function(a,b){var d={},c="No Surveys Found",g=null,f=null;d.setEmptyListViewParameters=function(a,b,d){c=a;g=b;f=d};d.render=function(d){var d=d||mwf.decorator.Menu(b),i,j;if(0<a.length){var k=function(a){return function(){PageNavigation.openSurveyView(a.getCampaign().getURN(),
a.getID())}};for(j=0;j<a.length;j+=1)i=d.addMenuLinkItem(a[j].getTitle(),null,a[j].getDescription()),TouchEnabledItemModel.bindTouchEvent(i,i,k(a[j]),"menu-highlight")}else null!==c&&(i=d.addMenuLinkItem(c,null,g),TouchEnabledItemModel.bindTouchEvent(i,i,f,"menu-highlight"));return d};return d},SurveyResponseView=function(a){var b={},d=a.getCampaign(),c=a.getSurvey(),g=a.getSurveyResponseModel();b.render=function(){var b=g.getLocation(),h=mwf.decorator.Menu(c.getTitle());h.addMenuLinkItem("Campaign",
null,d.getName());h.addMenuLinkItem("Survey",null,c.getTitle());h.addMenuLinkItem("Time Submitted",null,g.getSubmitDateString());h.addMenuLinkItem("GPS Status",null,g.getLocationStatus());null!==b&&h.addMenuLinkItem("GPS Location",null,b.latitude+", "+b.longitude);$(h).find("a").css("background","transparent");var i=mwf.decorator.Menu("User Responses"),j,k;for(j in g.data._responses)b=c.getPrompt(j),k=g.data._responses[j].value,k!==SurveyResponseModel.NOT_DISPLAYED_PROMPT_VALUE&&i.addMenuLinkItem(b.getText(),
null,b.summarizeResponse(k));$(i).find("a").css("background","transparent");i.style.display="none";j=mwf.decorator.DoubleClickButton("Delete",a.deleteSurveyResponseCallback,"Upload",a.uploadSurveyResponseCallback);var n=mwf.decorator.SingleClickButton("View User Responses",function(){"View User Responses"===n.getLabel()?(n.setLabel("Hide User Responses"),i.style.display="block"):(i.style.display="none",n.setLabel("View User Responses"))}),b=document.createElement("div");b.appendChild(h);b.appendChild(j);
b.appendChild(n);b.appendChild(i);b.appendChild(mwf.decorator.SingleClickButton("Upload Queue",PageNavigation.openUploadQueueView));return b};return b},SurveyView=function(a){var b={startSurveyButtonHandler:function(){},renderSummary:function(){var b=mwf.decorator.Content();b.setTitle(a.getTitle());b.addTextBlock(a.getDescription());return b},render:function(){var a=document.createElement("div");a.appendChild(b.renderSummary());a.appendChild(mwf.decorator.SingleClickButton("Start Survey",b.startSurveyButtonHandler));
return a}};return b},UploadQueueView=function(a){var b={},d=a.getPendingResponses(),c=function(){var a=mwf.decorator.Content("Pending Uploads");a.addTextBlock("Upload queue is empty.");return a};b.render=function(){var b=mwf.decorator.Menu("Pending Uploads"),f=function(a){return function(){PageNavigation.openSurveyResponseView(a.getSurveyKey())}},h,i,j,k;for(k in d)h=d[k].survey,i=d[k].response,j="Submitted on "+i.getSubmitDateString()+".",h=b.addMenuLinkItem(h.getTitle(),null,j),TouchEnabledItemModel.bindTouchEvent(h,
h,f(i),"menu-highlight");f=document.createElement("div");0<b.size()?(f.appendChild(b),f.appendChild(mwf.decorator.DoubleClickButton("Delete All",a.deleteAllCallback,"Upload All",a.uploadAllCallback))):f.appendChild(c());f.appendChild(mwf.decorator.SingleClickButton("Dashboard",PageNavigation.openDashboard));return f};return b};